---
layout: post
title: "Hadoopを中心とした分散環境での開発方法論・モデリング・設計手法等についての座談会(第5回）に参加しました。(Jugemより移植)"
slug: hadoopを中心とした分散環境での開発方法論・モデリング・設計手法等についての座談会-第5回）に参加しました。
author: johtani
date: 2011-06-29T23:10:00+09:00
comments: true
tags: [hadoop]
---
「[Hadoopを中心とした分散環境での開発方法論・モデリング・設計手法等についての座談会(第5回）](http://www.zusaar.com/event/agZ6dXNhYXJyDAsSBUV2ZW50GNc_DA)」に参加しました。300名入るイベントルームでしたが、後ろの方まで人が埋まっていました。<br />
ということで、主に自分用ですが、メモを取ったので。<br />
※二次会行きたかった。。。<br />
<br />
<br />
1.「鉄道システムへの誘い」<br />
　@ayasehiro（本名無理w）<br />
　Hadoopの話はありません。<br />
<br />
　○鉄道系基幹システムの開発<br />
　　実態：<br />
　　　耐用年数：１０年以上<br />
　　　開発期間：数年～５年程度<br />
　　　開発規模：～10Mステップ、10k人月～<br />
<br />
　　ほとんどテスト、しかも異常系が主体。<br />
　　夜間に実際に鉄道を走らせて試験したり。<br />
<br />
　　開発サイクルが長い<br />
　　　人材育成が難しい、ノウハウがたまらない。<br />
<br />
　　開発自体はほとんど時間がなく、設計・製造・試験など新規技術の採用が難しい。<br />
　　開発４年前の調査・検証自体が２年程度。<br />
　　Hadoopも調査中。<br />
　　<br />
　○鉄道システム３大システム<br />
　　マルス（予約オンラインシステム）（1960～）<br />
　　コムトラック（運行管理システム）（1972～）<br />
　　ヤックス（ヤード自動化システム）（1968～1984）<br />
<br />
　○鉄道輸送システムとは<br />
　　用語：<br />
　　　運行を計画する=>輸送計画<br />
　　　列車を運行する=>運行管理<br />
<br />
　　需要想定＋営業施策＋その他（お召し列車など）＝列車ダイヤ作成<br />
　　　基本計画（長期）＋短期計画（数日～四半期程度）＝列車ダイヤ（重ねあわせてできあがり）<br />
<br />
　　ダイヤの計画（発車時刻など）と車両運用（車両自体の走る組み合わせ（仮の車両））の作成<br />
　　＋乗務員運用（乗務員の運用計画）<br />
<br />
　　運行管理：<br />
　　　なにも起きなければすることなし。（車両故障、天候、人身事故などによる整合性を取る作業）<br />
　　　＝事前に計画した輸送計画をすべて見直し<br />
　　　遅延の検知は？<br />
　　　　昔：人による伝令<br />
　　　　今：システムによる検知（レールに電流流して検知）<br />
<br />
　　　運転整理（実際に遅れた）：<br />
　　　　部分運休、折り返し駅の変更などにより対応<br />
　　　　元の計画になるべく近づく形で修正していく。<br />
<br />
　　　新幹線、山手線、京浜東北線などは速度信号という信号が表示される。<br />
　　　線路上に信号はないらしい。<br />
<br />
　○鉄道システムを取り巻く情勢<br />
　　少子高齢化・人口減少のため凋落産業となっている。<br />
　　社会インフラの責務＝動くのが当たり前<br />
　　2007年問題（ベテランの引退）＝スジ屋さんは最近いないらしい。<br />
　　高度な判断支援をするシステムが必要<br />
　　　連続稼動＝分散技術を適用できない？<br />
　　　関係各所との情報共有<br />
　　　計画立案のための情報支援＝最適化技術を適用できない？<br />
　　<br />
　○分散処理技術の適用<br />
　　個人的な感想<br />
　　　可用性（連続稼動）のための仕組み<br />
　　　バッチ処理<br />
<br />
　○分散技術の適用<br />
　　・連続稼動<br />
　　　active-active構成がメイン<br />
　　　　主系の出力だけを行う。問題が出れば副系の出力。<br />
　　　3系統の出力を比較器にて出力もある<br />
　　　　magiシステム<br />
　<br />
　　　問題点：<br />
　　　　ハードが高い（H社）<br />
　　　　ソフトウェアの作り込みが複雑＝テストが前パターンできない<br />
　　　解決案：<br />
　　　　汎用的なハードが使いたい。<br />
　　　　作り込みも減らしたい<br />
　　・バッチ処理：<br />
　　　Asakusa使えないかなーw<br />
<br />
　○最適化技術の採用<br />
　　コンピュータ技術の発展<br />
　　2007年問題<br />
　　　職人に言わせれば最適化はいらない、俺の言うことを聞けｗ<br />
<br />
　　・車両運用のモデリング<br />
　　　車両数大=>組み合わせ大<br />
　　　制約条件が多い<br />
　　　車両運用の場合、走行累積キロの条件もある<br />
　　　->有向グラフにモデル化される。（ただし、グラフ化するまでが大変）<br />
　　・乗務員運用のモデリング<br />
　　　車両と違い、乗務員は1回で2人とか運べる（運転士＋移動する人とか）<br />
<br />
　　・車両割当のモデリング<br />
　　　やはり、グラフ化が可能<br />
<br />
　　・乗務員交番のモデリング。。。など<br />
<br />
　　結構一般的なモデルに落とし込める。ただし、落し込みが大変。<br />
　　机上研究だったものが、コンピュータの発展により実証研究になりつつある。<br />
　　<br />
　○まとめ<br />
　　鉄道システムはまだまだ未到の領域が残っている。<br />
　　開発サイクルが長いため、保守的な開発になる（35年前の設計思想からあまり変わってなかったりする）<br />
　　しかし業務要件やシステム利用者の意識は変化している<br />
　　<br />
　　興味を持たれた方は、ぜひ、我社に！（社名は2次会でｗ）<br />
<br />
　○Q&A<br />
　　Q：鉄道システムのカルチャーってイケイケ？保守的？（@okachimachiorgさん）<br />
　　A：最新技術も知らないとだめじゃないかという人が出てきている。<br />
　　　 コア部分（安全第一なところ）＋周辺領域（ある程度融通が効きそうな部分）と考えることができるんじゃないかって人も出てきている。<br />
　　　 JR九○＝先進的<br />
　　　 JR四○、北○道＝お金ない<br />
　　　 JR○海＝超保守（企業的に超保守）<br />
　　　 JR東、西＝うーむ？<br />
　　　 東京メト○（運行計画）、阪○＝先進的<br />
　　　 京○急行＝基本人間で進路制御w<br />
　　　基本的には新しいものには興味をもつ人たちでは。<br />
　　Q：Su○caとかで分散処理は利用出来るんでは？<br />
　　A：匿名なので外側から見ていると分散処理はいろいろ使えるんでは？<br />
　　　 ログデータからいろいろできるんじゃないの？活かすべきでないの？<br />
　　　 使いどころはいっぱいある。<br />
　　Q：鉄道システムでどうしようもなくなったことはあるか？<br />
　　A：保守体制が一番気になる。<br />
　　　 OSSとかならまだ調べられる。ミドルウェアなどの保守契約が必要。<br />
　　　 保守体制が確立されてればある程度の保守費用は飲み込む。<br />
　　　 どうしようもないことはないが、今すごく困ってることは<br />
　　　 Excelで帳票を出したいとかいわれること。（ちょっと前に作ったシステムでExcel2003。バージョンあげると速度が遅くなったりするｗ）<br />
　　　 ilog社のものを使ってたが、IBMに買収されて保守費用があがってこまってるｗ<br />
　　　 保守が10年と長いため、サポートなどの折衝が必要。<br />
　　Q：最適化の適用範囲は？<br />
　　A：走行順序（どこで追い抜くか）の算出に活用。ほぼ完成でユーザ教育中。<br />
　　　 1列車の波及がかなり影響が出る。ダイヤだけ見ると列車だけだが、乗務員も関係しており、大変。<br />
　　　 ある時点から終電までを最適化の対象としたりして割り切っている。<br />
　　　 また、不足分について算出が出来れば、そこで打ち切ったりもする。<br />
<br />
2.「九州電力におけるHadoopの取り組みについて」<br />
　株式会社キューデンインフォコム e－ビジネス部　@hisashi_yano<br />
　概要：2年間関係したOSSをメインにしたシステムの話。<br />
<br />
　○九州電力の概要<br />
　　現在風当たりが強い業界。<br />
　　東電の1/10くらい<br />
　　部門ごとに大手ベンダーが関わってる。<br />
<br />
　○Hadoop採用の経緯<br />
　　部門ごとに個別最適なシステムを導入していてベンダーロックインされてる。<br />
<br />
　　　　・ホストのリプレース<br />
　　・両現用センター構成への対応<br />
　　・スマートグリッドへの対応<br />
<br />
　　問題点<br />
　　・コスト削減<br />
　　・技術革新への中の人の対応（内部でも問題を理解できるように）<br />
　　・商用パッケージのカスタマイズの限界<br />
　　・脱ベンダーロックイン（実は楽なんだけど。。。）<br />
<br />
<br />
　○過去2年間の研究内容<br />
　　・H21年度の結果<br />
　　　テーマ：クラウドの要素技術の研究<br />
　　　　KVM、Eucalyptus、wakame、hadoop　　　<br />
　　　<br />
　　　性能比較：VMWareとKVM->ベンチマーク比較<br />
　　　　　結論：性能的にあまり問題なし。<br />
　　　MapReduceの耐障害性など<br />
　　　　　ダミーデータにより台数増加による影響を検証<br />
　　　　　結論：台数大->性能向上<br />
　　　　　　　　ストリーミングは性能劣化する<br />
　　　　　　　　スループットはリニアに向上<br />
　　　　　信頼性は？<br />
　　　　　　実行中にノードを抜いたりして検証。<br />
　　　　　結論：問題なし。<br />
　　　クラウド環境におけるシステム管理手法<br />
　　　　複数ハードで1アプリという構成になる。<br />
　　　　監視対象が膨大になる。<br />
　　　　障害発生時の切り離しや監視対象も膨大。<br />
　　　　データセンター自体を監視する仕組みが必要では？というところで終了。<br />
<br />
　　・H22年度の結果<br />
　　　分散に特化した研究<br />
　　　前年度の課題<br />
　　　　サーバの仮想化・管理に関する課題<br />
　　　　分散処理に関する課題<br />
　　　　分散処理環境の運用監視に関する課題<br />
　　　目的：<br />
　　　　Hadoopを本番への適用（実際にはダミーデータ＋本番の仕組み）<br />
　　　<br />
　　　柔軟なサーバ統合基盤（サーバを起動->バッチを起動->回す仕組み）＝MonkeyMagic<br />
　　　　libvirtを使ってる<br />
　　　　<br />
　　　50台の仮想サーバの起動が10数分で完了。<br />
<br />
　　運用監視基盤（monkey magic）<br />
　　　仮想、実サーバ混在の監視<br />
　　　監視状況（サーバの状況）から判断して制御する仕組みを構築<br />
　　　DSLにてルール（判断＋制御）を指定<br />
　　　・ジョブの監視<br />
　　　・ジョブの実行管理<br />
　　　・構成管理の省力化<br />
　　　　volanteと連携が可能＝AmazonWebServiceとも連携可能<br />
　　　・サーバリソース＋アプリケーションの一括監視が可能<br />
　　分散バッチ処理の概要<br />
　　　RDBからKV形式にして抽出し、MRで回してRDBに戻すという研究<br />
　　　対象：<br />
　　　　配電部門（電柱の設備情報の目視検査）のデータの月間バッチ処理<br />
　　　現状：<br />
　　　　19時間程度かかってる。<br />
　　　テスト環境：<br />
　　　　実サーバ2台（仮想10台）<br />
　　　　MySQL、Javaで実装<br />
　　　処理内容<br />
　　　　電柱104万本<br />
　　　　巨大バッチを分割して実装<br />
　　　結果<br />
　　　　MySQL1台では15日以上かかる処理（現行システムで19時間）<br />
　　　　処理が32分で終了！他でも効果でるよね。<br />
　　　バッチ短縮の理由は？<br />
　　　　1.データアクセスが分散された<br />
　　　　2.処理の並列化（多重化出来る部分がうまくできた）<br />
　　　<br />
　　分散処理を書くのに2名死亡。。。<br />
<br />
　　適用基準の策定、開発ガイドライン、フレームワーク整備などが必要。<br />
<br />
　・H23年度は？<br />
　　Asakusaの適用など。<br />
<br />
　・さらに今後は？<br />
　　スマートグリッドへの適用<br />
　　　->メーターの交換が必要だが、10年くらいかかる<br />
　　　->スパンが長い（10年）ので商用製品だときつい？<br />
　　　データ量も半端ない。<br />
　　　テネシー州とClouderaでOpenPDCってのやってるらしい。<br />
　　<br />
　　電力と気温の関係は密接な関係あり。<br />
　　　エアコンが割合を占めてるから。<br />
　　　過去実績と予想気温データから分析するのにHadoop使える！<br />
　　　<br />
　・2年間やってきて思うこと<br />
　　将来目指すべき理想像を掲げるのが重要<br />
　　新技術導入は段階を踏むことが必要<br />
　　コミュニケーション大切！<br />
<br />
　○Q&A<br />
　　Q：仮想化環境のオーバヘッドは？（I/O）<br />
　　A：台数を増やしたときにどうなるか？というのを検証したかった。<br />
　　　アプリ配布も考えていたので、物理サーバに縛られたくなかった。<br />
　　Q：仮想化に関して気をつけたM/RのPGで気をつけたことありますか？<br />
　　A：まったくないです。<br />
　　Q：日本でスマートグリッドははやるの？<br />
　　A：電力会社的にはやりたくない。費用対効果があまりない。<br />
　　Q：今後のスケジュールは？<br />
　　A：文書管理システムの組織名変更などの処理時間が540時間とかでてくるらしい。<br />
　　　これをHadoopで対応してみようかと思ってる。<br />
　　Q：Asakusaをどう評価していくのか？<br />
　　A：開発効率性があがるか？は検証する予定。1/3くらい楽になるんじゃないかなぁ？byのぐちさん<br />
　　　バッチの種類などにもよると思うが、標準化も指標にする予定。<br />
　　　結果はまたこの場で報告する予定。<br />
　　Q：Asakusa＋MonkeyMagicの連携はどんなこと考えてる？<br />
　　A：MonkeyMagicを運用基盤として行く予定。合意が取れればだけど。<br />
　　※MonkeyMagicもOSSにするよー<br />
<br />
<span style="font-size:medium;">まとめ<br />
Hadoopから少しずつ離れつつありますが、やはり興味があるので、非常に楽しく話を聞けました。<br />
また、今回はインフラ分野のシステムということで、システムに要求されるレベルや<br />
運用周りにも気を配っている話が聞けたのが収穫でした。保守期間が長いため、テストが長い＝<br />
運用もしっかりと考慮を入れた設計、実装が必要になるというのは最もだと思います。<br />
ただ、少しずつ修正が入るアジャイルなども同様かと。<br />
<br />
MonkeyMagicが出来上がってきた背景の話を聞いて、さらに興味が湧いてきたところです。<br />
今後もかかわりが少ないかもしれないですが、ウォッチしていきたいと思いました。<br />
<br />
ただ、興味あるモノが多すぎるので、優先度をつけつつこなして行かないと。。。<br />
少しずつでも身につけていきたいと思う今日このごろです。<br />
<br />
<br />
※追記：Twitterでコメントを頂いたので、忘れないように追記。<br />
コメントを貰えるだけでもうれしい。やはり、アウトプットしたらフィードバック貰いたいし。<br />
ありがとうございます！<br />
<br />
[Twitter / @cocoatomo: あの質問をまとめるとこうなるのかぁ…… 最適化そのも ...](http://twitter.com/#!/cocoatomo/status/86124705140047872)<br />
<br />
[Twitter / @cocoatomo: @johtani すみません, コメントはコメント欄 ...](http://twitter.com/#!/cocoatomo/status/86236412344680448)<br />
<br />
[Twitter / @cocoatomo: @johtani そこらへんの理論って最後には計算量 ...](http://twitter.com/#!/cocoatomo/status/86236865174323200)<br />
<br />
[Twitter / @cocoatomo: @johtani あの話し振りだとどうもまだ本格的に ...](http://twitter.com/#!/cocoatomo/status/86281140184432641)<br />
<br />
あと、まとめも出来ていたので、ついでに。<br />
<a href="http://togetter.com/li/155628">Togetter - 「2011/06/29_Hadoopを中心とした分散環境での開発方法論・モデリング・設計手法等についての座談会(第5回） #hadoopmodeling」<a/><br />
<br />
関連するブログも見つけたので。<br />
<br />
[第5回Hadoop座談会の感想 - ひしだまの変更履歴](http://blog.goo.ne.jp/hishidama/e/a6c5ae00a7a1bacbc88e023691a2eb0c)<br />
<br />
[Hadoopモデリング座談会（第5回）へ行ってきました - 虎塚](http://d.hatena.ne.jp/torazuka/20110629/hadoop)
