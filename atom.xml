<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[@johtaniの日記 2nd]]></title>
  <link href="http://blog.johtani.info/atom.xml" rel="self"/>
  <link href="http://blog.johtani.info/"/>
  <updated>2018-07-29T18:39:55+09:00</updated>
  <id>http://blog.johtani.info/</id>
  <author>
    <name><![CDATA[johtani]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[JJUGナイトセミナーで話しました]]></title>
    <link href="http://blog.johtani.info/blog/2018/07/29/apm-java-at-jjug/"/>
    <updated>2018-07-29T14:45:30+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/07/29/apm-java-at-jjug</id>
    <content type="html"><![CDATA[<p><a href="https://jjug.doorkeeper.jp/events/77485">7/25にJJUGナイトセミナー</a>でElastic Stackの紹介とAPMのJava Agentの紹介をしたので、補足のブログです。
（久々に書くな。。。）</p>

<!-- more -->


<p>スライドとサンプルアプリのリポジトリはこちら。</p>

<ul>
<li>スライド：<a href="https://speakerdeck.com/johtani/intro-elastic-stack-and-elastic-apm-java">https://speakerdeck.com/johtani/intro-elastic-stack-and-elastic-apm-java</a></li>
<li>リポジトリ：<a href="https://github.com/johtani/apm-beats-kubernetes-demo/tree/master">https://github.com/johtani/apm-beats-kubernetes-demo/tree/master</a></li>
</ul>


<h3>サンプルアプリ</h3>

<p>勉強会の頭でサンプルアプリへのアクセス用QRコードを用意して質問してもらう感じにしました。</p>

<p><img src="http://blog.johtani.info/images/entries/20180729/APM___Beats_demo_app.jpg" width="600"></p>

<p>アプリ自体が質問の受付と、そこにある質問に対して聞きたいかどうかのVoteができる仕組みになっています。
セッション最後にこの画面をみながら答えました。
手を挙げていただくよりも、匿名（名前入れるようになってますが、実名である必要はない）で登録できるし、
みんなが聞きたいかどうかもわかるので便利だなぁと。</p>

<p>元は、Elastic{ON} 2018であった「<a href="https://www.elastic.co/webinars/elasticsearch-log-collection-with-kubernetes-docker-and-containers">Docker &amp; Kubernetes Log Collection and Monitoring with Beats and Elasticsearch</a>」のサンプルアプリです。
これをSpring Bootに移植して、ちょっとだけサンプルコードを追加したものになります。</p>

<h3>構成とかの補足</h3>

<p>スライド、GitHubのリポジトリのREADMEにある図は、k8s上のサンプルアプリケーションの構成だけでした。
ElasticsearchとKibanaを含めた図はこんな感じです。</p>

<p><img src="http://blog.johtani.info/images/entries/20180729/system-overview.jpg" width="600"></p>

<p>k8s上の各種Beats、APM Serverは一旦Elastic CLoud Elasticsearch Service（AWS Tokyoリージョンにデプロイ）に対してデータを投げます。
で、KibanaはGKE(k8s on GCP)で動かして、実際に勉強会ではkubectl proxyで接続してから表示していました。
この構成にしている理由は次の理由です。</p>

<ul>
<li>Elastic CloudのElasticsearchクラスターにデータを投げている理由

<ul>
<li>クラスターの起動が簡単。</li>
<li>データを永続化したい。k8sのアプリは必要がなくなったらデータを削除したいから。</li>
<li>k8sのdeploymentを書く手間を省く</li>
<li>普段使ってるので。。。</li>
</ul>
</li>
<li>KibanaをGKEで動かした理由

<ul>
<li>Elastic Cloudでは<em>「現時点(7/29現在)」</em>で、KibanaでAPM専用のUIを起動できない</li>
<li>ローカルである必要はない</li>
</ul>
</li>
</ul>


<p>といったところです。
Elastic Cloudのインスタンスを起動したままにしておけば、デモをしなくても、このタイミングのログ、メトリクスを
再利用して話をすることも可能です。</p>

<h3>まとめ</h3>

<p>ということで、簡単ですが、構成の補足でした。
勉強会では告知したのですが、今後の勉強会はトピックスごとでやりたいなと。ということで、どんなトピックスに興味があるのか、スピーカーの応募にはどんなツールが話しやすいかなどといったことのアンケートを集めております。ぜひご協力ください！
また、アンケート、このブログに関する質問がある場合は、<a href="https://twitter.com/johtani">@johtani</a>、もしくはブログへのコメントでお願い致します。</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">今後の勉強会のやり方などについてアンケートを実施中です。<a href="https://t.co/XU15CHro0n">https://t.co/XU15CHro0n</a> 皆さん是非ご協力ください。ここにない項目については返信をお願いします。 <a href="https://twitter.com/hashtag/elasticsearchjp?src=hash&amp;ref_src=twsrc%5Etfw">#elasticsearchjp</a></p>&mdash; Jun Ohtani (@johtani) <a href="https://twitter.com/johtani/status/1021388358730170368?ref_src=twsrc%5Etfw">2018年7月23日</a></blockquote>


<p> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Analyze UIとKibanaのプラグインの作成方法（第3回）]]></title>
    <link href="http://blog.johtani.info/blog/2018/04/20/directory-layout-and-architecture/"/>
    <updated>2018-04-20T15:30:01+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/04/20/directory-layout-and-architecture</id>
    <content type="html"><![CDATA[<p><a href="http://blog.johtani.info/blog/2018/02/09/getting-started-template-kibana-plugin/">第2回</a>から少し間が空いてしまいましたが、templateで作成したプラグインのディレクトリ構成とどういう流れでデータがやり取りされるかについてみていきます。
（2018/02月時点で作成したディレクトリ構成にしたがって説明します）
ちなみに、JavaScriptの優れた開発者ではないので、誤解している点や、効率の悪い書き方などがあるかもしれません。見つけた場合は、連絡をいただければと思います。</p>

<!-- more -->


<p>では、まずは作成したディレクトリ構成についてみていきましょう。</p>

<h2>ディレクトリ構成</h2>

<p><code>simple-sample-kibana-plugin</code>がプラグインのプロジェクトのトップディレクトリになります。このディレクトリに次のような構成でサブディレクトリが存在します(なお、画像はIntelliJに取り込んだ後のディレクトリになっているので、<code>.iml</code>など、不要なファイル/ディレクトリが存在しています)。</p>

<p><img src="http://blog.johtani.info/images/entries/20180420/directories.jpg" width="400"></p>

<p>主要なディレクトリ、ファイルについて簡単に一覧で説明します(順不同)。</p>

<table>
<thead>
<tr>
<th> ファイル/ディレクトリ名 </th>
<th> 説明 </th>
</tr>
</thead>
<tbody>
<tr>
<td> index.js </td>
<td> プラグインの本体。Kibanaはこのファイルのオブジェクトを読み込みプラグインを起動。設定などの読み込みもこちら。 </td>
</tr>
<tr>
<td> package.json </td>
<td> npm/yarnのパッケージに関する情報を定義するファイル </td>
</tr>
<tr>
<td> README.md </td>
<td> README。プラグインの説明などを記載する。インストール方法なども記載すると便利 </td>
</tr>
<tr>
<td> public </td>
<td> ブラウザ側に配布されるプログラムや画像一式 </td>
</tr>
<tr>
<td> public/less/main.less </td>
<td> LESS用のファイル。アプリ固有のスタイルなどを記載 </td>
</tr>
<tr>
<td> public/app.js </td>
<td> ブラウザ側で読み込まれるプラグインのモジュールなど。 </td>
</tr>
<tr>
<td> public/template/index.html </td>
<td> HTMLのテンプレート。ブラウザ上での描画に利用 </td>
</tr>
<tr>
<td> server/routes </td>
<td> Kibanaサーバー側で動作するプラグイン。hapi.jsを利用してREST APIを実装する </td>
</tr>
</tbody>
</table>


<p>重要なファイルについて少しだけ説明します。</p>

<h4>package.json</h4>

<p>npmやyarnでビルドなどをするときに使用するパッケージ情報を記載するためのファイルです。
プラグインの名前、バージョン、説明などを記載します。
Kibanaのバージョンについてもこちらで管理します。この情報を
また、ライブラリなどの依存関係についてもこちらで記載しています。
以下、抜粋。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;simple-sample-kibana-plugin&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Sample plugin for explaining how to make kibana app&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;kibana&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;6.2.1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;templateVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;7.2.4&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;lint&quot;</span><span class="p">:</span> <span class="s2">&quot;eslint **/*.js&quot;</span><span class="p">,</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;@elastic/eslint-config-kibana&quot;</span><span class="p">:</span> <span class="s2">&quot;^0.14.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;@elastic/eslint-import-resolver-kibana&quot;</span><span class="p">:</span> <span class="s2">&quot;^0.9.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;@elastic/plugin-helpers&quot;</span><span class="p">:</span> <span class="s2">&quot;^7.1.3&quot;</span><span class="p">,</span>
</span><span class='line'><span class="err">...</span>
</span><span class='line'>    <span class="nt">&quot;expect.js&quot;</span><span class="p">:</span> <span class="s2">&quot;^0.3.1&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ちなみに私は、<code>version</code>などをリリースするたびに変更しています。</p>

<h4>index.js</h4>

<p>最初にKibanaに読み込まれるオブジェクトになります。
Kibanaのアプリの名前や、必要なモジュールなどを記載します。</p>

<p>また、<code>kibana.yml</code>から設定など読み込む処理なども書くことができます。</p>

<p>2行目の<code>exampleRoute</code>はサーバー側のAPIとして利用するhapi.js用のファイルのパスになります。</p>

<p><code>uiExports</code>はこのアプリの画面に関する設定などの記載になります。
<code>app</code>の部分が実際にアプリの情報で、
<code>main</code>があとで説明するこのプラグインのUIのためのJavaScriptファイル(public/app.js)になります。mainですので、最初に読み込まれる処理が記載されているものを指定します。<code>app.js</code>というファイル名を変更する場合は、こちらの<code>app</code>の部分を変更したファイルに合わせましょう。</p>

<p><code>config(Joi)</code>の関数が設定ファイルの読み込みなどの処理を記載する場所です。</p>

<p><code>init(server, options)</code>の関数が初期化処理を記載する場所になります。
このサンプルアプリでは、2行目の<code>import</code>で読み込んだhapi.js用のファイルの関数を呼び出しています。引数で渡している<code>server</code>がhapi.jsの<code>server</code>オブジェクトになります。
<code>route</code>メソッドを使用して作成しているプラグイン用のREST APIを追加しています。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="p">{</span> <span class="nx">resolve</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">exampleRoute</span> <span class="nx">from</span> <span class="s1">&#39;./server/routes/example&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">kibana</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">new</span> <span class="nx">kibana</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">require</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;elasticsearch&#39;</span><span class="p">],</span>
</span><span class='line'>    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;simple-sample-kibana-plugin&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">uiExports</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">app</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Simple Sample Kibana Plugin&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;Sample plugin for explaining how to make kibana app&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">main</span><span class="o">:</span> <span class="s1">&#39;plugins/simple-sample-kibana-plugin/app&#39;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">config</span><span class="p">(</span><span class="nx">Joi</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Joi</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">enabled</span><span class="o">:</span> <span class="nx">Joi</span><span class="p">.</span><span class="kr">boolean</span><span class="p">().</span><span class="k">default</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span class='line'>      <span class="p">}).</span><span class="k">default</span><span class="p">();</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">init</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Add server routes and initialize the plugin here</span>
</span><span class='line'>      <span class="nx">exampleRoute</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h4>public/app.js</h4>

<p>画面用のモジュールです。
<code>uiRoutes</code>という機能を使用して、アプリの呼び出しURLを定義します。テンプレートで作成したばかりの場合は、<code>/</code>というURLが追加されるのみです。</p>

<p>実際に画面を表示する際に動くコントローラーの部分はその下の
<code>uiModules.controller</code>に指定してあるfunctionが画面描画の
処理を書く部分になります。
templateで作成したプラグインでは、&#8221;title&#8221;など表示に必要なデータを<code>$scope</code>というオブジェクトに詰め込んでいます。
これはAngularJS(1系)でのモデルオブジェクトになります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">moment</span> <span class="nx">from</span> <span class="s1">&#39;moment&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="p">{</span> <span class="nx">uiModules</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ui/modules&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">uiRoutes</span> <span class="nx">from</span> <span class="s1">&#39;ui/routes&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">import</span> <span class="s1">&#39;ui/autoload/styles&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="s1">&#39;./less/main.less&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">template</span> <span class="nx">from</span> <span class="s1">&#39;./templates/index.html&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">uiRoutes</span><span class="p">.</span><span class="nx">enable</span><span class="p">();</span>
</span><span class='line'><span class="nx">uiRoutes</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">template</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">uiModules</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;app/simple-sample-kibana-plugin&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;simpleSampleKibanaPluginHelloWorld&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$route</span><span class="p">,</span> <span class="nx">$interval</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s1">&#39;Simple Sample Kibana Plugin&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="s1">&#39;Sample plugin for explaining how to make kibana app&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">$watch</span><span class="p">(</span><span class="s1">&#39;$destroy&#39;</span><span class="p">,</span> <span class="nx">unsubscribe</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>server/routes/example.js</h4>

<p><a href="https://hapijs.com">hapi.js</a>というNode.jsのためのサーバーフレームワークです。
このフレームワークをKibanaは使っており、Kibanaのサーバーとブラウザとのやり取りに使用するREST APIを記述するために使用しています。
例えば、Elasticsearchとのやり取りを実際に行うAPIなどをこのREST API内部で記述します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/api/simple-sample-kibana-plugin/example&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">handler</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">reply</span><span class="p">({</span> <span class="nx">time</span><span class="o">:</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">toISOString</span><span class="p">()</span> <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>path</code>の部分がブラウザ側からアクセスするURLになります。
実際にElasticsearchとやり取りする処理の書き方については、次回の記事で説明します。</p>

<h2>アーキテクチャ（簡易版）</h2>

<p>ざっくりですが、ファイルやディレクトリについて説明しました。
簡単なデータのやり取りについての流れを説明します。</p>

<p>Kibana自体はNode.jsで実装されサーバーとして動作していますが、ブラウザでアクセスすることで画面を描画しています。
簡単なコンポーネントを並べるとデータのやり取りはこのような形です。</p>

<p><img src="http://blog.johtani.info/images/entries/20180420/architecture.jpg" width="600"></p>

<p>すごく簡易で大雑把な絵ですが。。。</p>

<p>実際のプラグインとしては大きく、2つの処理があります。</p>

<ul>
<li>ブラウザ上の処理

<ul>
<li>クリックなどのイベント処理</li>
<li>HTMLなどのレンダリング処理</li>
</ul>
</li>
<li>Kibanaサーバー上の処理(Elasticsearchなどとの通信が必要な場合)

<ul>
<li>外部との通信処理</li>
<li>ブラウザ上では重い処理</li>
</ul>
</li>
</ul>


<p>絵に記載しましたが、ブラウザ上の処理についてはAngularJSが主なフレームワークで、サーバー上の処理についてはhapi.jsがフレームワークとなっています。</p>

<h2>まとめ</h2>

<p>ということで、今回はディレクトリ構造とファイルの説明、どういったフレームワークが使われ、データのやり取りがどのように行われているか説明しました。</p>

<p>次回からは、実際に私が作成した<a href="https://github.com/johtani/analyze-api-ui-plugin">Analyze UI</a>を元にElasticsearchとのデータのやり取りなどについて紹介していきます。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[カンファレンス情報の探し方（CfP、スポンサー応募、開催期間など）？]]></title>
    <link href="http://blog.johtani.info/blog/2018/03/24/how-to-find-conferences/"/>
    <updated>2018-03-24T13:50:12+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/03/24/how-to-find-conferences</id>
    <content type="html"><![CDATA[<p> #MANABIYA のブースでセッション時間の合間はお客さん少ないので、ブログを書いてみたり。
ここ数年、スポンサーとして色々なカンファレンスに参加してるんですが、それについてちょっと気なることがあったので。</p>

<!-- more -->


<h2>スポンサー情報ってどうやって探してます？</h2>

<p>職業柄、カンファレンスにCfP出してセッションしてみたり（落ちること多いけど）、スポンサーとしてブースを出したりしています。</p>

<p>で、疑問があるんですが、みなさんどうやってカンファレンスの情報をゲットしてます？</p>

<p>数年やって来て、検索したりして見つけてスポンサーした結果、
これまでスポンサーしていたので、情報が流れてくるという感じになりました。
それ以外だと、@yusuke さんに教えてもらったりと言うのがあったんですが。。。</p>

<p>自分が知らない、自分のTwitterで流れてこないという情報をどうやったら集められるかな？と言うのが今の課題になってます。
と言うことで、ブログを書いてみました。</p>

<h2>カンファレンスを検索できるサイトとか便利？</h2>

<p>で、私の会社は検索エンジンの会社なんで、検索できると便利では？と考えるんです。</p>

<p>CfPの応募期間で絞り込みできたり、場所で検索できたり、スポンサー情報を取得する方法が載ってたりすると便利なのではないかなと。
便利に思うのが自分だけでは？と言うのがあるんですが。。。</p>

<p>あると嬉しい人、データを掲載したいなと言う人いますでしょうか？
Google Formなどで入力してもらえるようにして何か作るのもありかなぁと考えているところです。
それとも、スポンサーを募っているカンファレンスのスタッフや企業の人は、こういう情報は特定の人にだけ知ってもらったりしたいでしょうか？</p>

<p>自分だけではわからないことが多いので、懸念事項や、それダメでしょ？
あると便利！などのフィードバックをいただけると助かります。</p>

<p>それ以外に、カンファレンス自体の場所、開催日程、サイトへのURLなどが検索できると便利だったりするかも？というのもあります。</p>

<p>とりあえず、自分が知ってるものだけ、個人的に検索できるようにしたりするのがいいかなぁ。。。
コメントお待ちしてます！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[第1章の05から06までやってみた（言語処理100本ノック）]]></title>
    <link href="http://blog.johtani.info/blog/2018/03/20/nlp100-ch01-05to06/"/>
    <updated>2018-03-20T21:34:45+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/03/20/nlp100-ch01-05to06</id>
    <content type="html"><![CDATA[<p>Rustで言語処理100本ノックの続きで、05と06です。</p>

<!-- more -->


<h3>05. n-gram</h3>

<p>問題は<a href="http://www.cl.ecei.tohoku.ac.jp/nlp100/#sec05">こちら</a>。</p>

<p>みんな大好きn-gramです。単語と文字があるので、それぞれ別関数として実装しました。問題はbi-gramと<code>n=2</code>だったのですが、一応、<code>n</code>を引数に取る形にして実装しました。</p>

<p>まずは、単語です。</p>

<script src="http://gist-it.appspot.com/https://github.com/johtani/nlp100-rust/blob/5439f96e8521bffe34689c23aa076eb3a2fe817b/src/chapter01/answer.rs?slice=128:139"></script>


<p>前に実装した時は、自分で頑張って、先頭から数えたりしてたんですが、Rustには<a href="https://rust-lang-ja.github.io/the-rust-programming-language-ja/1.6/std/primitive.slice.html#method.windows">windows(n)</a>という便利なメソッドがsliceにあり、これを利用したらこんな簡単になりました。
sliceは特定のシーケンス（配列）に対してある特定のサイズのViewを作ってくれます（説明あってる？）。
ということで、文字列から、単語の配列（スペース区切りで単語にしている）を作り出して、<code>windows(n)</code>メソッドを通すと、
<code>n</code>で指定した数字の個数だけの単語の配列を先頭から、1単語ずつずらして作ってくれます。まさに、n-gram!
戻り値は配列の配列です。
1点だけ疑問点があるのは、「空白で区切ったものが単語」という考え方で良いかどうか？という点です。特に問題文にはそれが明示されていなかったので、このような前提を置いてあります。</p>

<p><code>invalid_n(text, n)</code>は<code>n</code>の値や入力された文字列をチェックする関数です。入力チェックですね。<code>n</code>が1よりも小さい場合、入力文字列が空文字の場合は、warningでメッセージを出して、空の配列を返す仕組みになっています。</p>

<script src="http://gist-it.appspot.com/https://github.com/johtani/nlp100-rust/blob/5439f96e8521bffe34689c23aa076eb3a2fe817b/src/chapter01/answer.rs?slice=115:126"></script>


<p>次は、文字です。</p>

<script src="http://gist-it.appspot.com/https://github.com/johtani/nlp100-rust/blob/5439f96e8521bffe34689c23aa076eb3a2fe817b/src/chapter01/answer.rs?slice=128:139"></script>


<p>単語とほぼ一緒ですが、入力文字列を、1文字ずつの配列にしているところが異なります。
また、<code>windows</code>メソッドで取り出された、1文字ずつの<code>n</code>個の配列を文字列に修正してから、結果の配列に入れています。
ここでも疑問は空白をどう扱うか？になります。
現時点では、空白も1文字とカウントして扱うことにしてあります。
どっちがいいのかなぁ？</p>

<h3>06. 集合</h3>

<p>問題は<a href="http://www.cl.ecei.tohoku.ac.jp/nlp100/#sec06">こちら</a>。</p>

<p>まずは、文字n-gramで出てきた文字列をSetに入れる関数から。</p>

<script src="http://gist-it.appspot.com/https://github.com/johtani/nlp100-rust/blob/5439f96e8521bffe34689c23aa076eb3a2fe817b/src/chapter01/answer.rs?slice=159:174"></script>


<p>n-gramの問題で実装した文字n-gramの関数の戻り値を配列ではなく、BTreeSetに変えたものになります。比較などがしやすいように？と思い、BTreeSetを利用していますが、実装としてはHashSetでも問題ないかと。
この関数の集合（Set）を元に、和集合、積集合、差集合を求める関数を実装しました。</p>

<script src="http://gist-it.appspot.com/https://github.com/johtani/nlp100-rust/blob/5439f96e8521bffe34689c23aa076eb3a2fe817b/src/chapter01/answer.rs?slice=176:187"></script>


<p>Setのメソッドとして、それぞれ、<code>union</code>＝和集合、<code>intersection</code>＝積集合、<code>difference</code>＝差集合のメソッドが用意されているので、特に困ることはなかったです。
差集合については、1-2と2-1で結果が異なるはずなので、それぞれをテストケース、main.rsで出力するようにしてあります。</p>

<h3>所感</h3>

<p>今回は、Rustがすでに実装してくれているメソッドがあったので楽ができました。
やりたいことに相当するメソッドがあるかどうかを調べるためにリファレンスを探さないといけないのがちょっと苦労しましたが。。。
ということで、今日はこの辺りまで。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[第1章の03から04までやってみた（言語処理100本ノック）]]></title>
    <link href="http://blog.johtani.info/blog/2018/02/19/nlp100-ch01-03to04/"/>
    <updated>2018-02-19T18:34:08+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/02/19/nlp100-ch01-03to04</id>
    <content type="html"><![CDATA[<p>Rustで言語処理100本ノックの続きで、03と04です。</p>

<!-- more -->


<h3>03. 円周率</h3>

<p>問題は<a href="http://www.cl.ecei.tohoku.ac.jp/nlp100/#sec03">こちら</a>。</p>

<script src="http://gist-it.appspot.com/http://github.com/johtani/nlp100-rust/blob/8ca508cc16fbc7a11ac04bbc43687dfec4f25483/src/chapter01/answer/mod.rs?slice=60:71"></script>


<p>入力文字列を<code>.split_whitespace()</code>で分割しておいて、単語ごとのベクタを作り出し、そこに対して文字を数えました。「アルファベットの」という注意書きがあるので&#8221;,&ldquo;や&rdquo;.&ldquo;は含めずに数えるのかなということで、
charの<code>.is_alphabetic()</code>で<code>A-z</code>までの判定をしつつ、文字のベクタを作ってから、そのベクタの長さを詰め込むという感じでやりました。</p>

<p>これ、ひょっとして、collectでベクタにしなくても、i32とかの変数でカウントするとベクタ作らなくてもいいなじゃにか？というのに書きながら気づいた。。。
必要じゃないオブジェクトを作ってるよなぁ。</p>

<p><code>.filter().map</code>とかかな？この辺りの操作がイマイチ苦手。Javaでもまだ馴染めてないところなんだよなぁ。頭固すぎ。</p>

<h3>04. 元素記号</h3>

<p>問題は<a href="http://www.cl.ecei.tohoku.ac.jp/nlp100/#sec04">こちら</a>。</p>

<script src="http://gist-it.appspot.com/http://github.com/johtani/nlp100-rust/blob/8ca508cc16fbc7a11ac04bbc43687dfec4f25483/src/chapter01/answer/mod.rs?slice=73:112"></script>


<p>大作ですね。何だろう、大作。。。
最終的に連想配列（辞書型もしくはマップ型）」ということだったので、BTreeMapに詰め込んでます。
HashMapでもいいんですが、文字列で出力した時にキーが並んで見やすいからという理由で、BTreeMap使いました。それ以上の理由はないです。普通にやるなら、HashMapかな？</p>

<p>入力として、1文字だけの出力をする場所（インデックス番号）の配列を受け取ってます。1点だけ、チェックしていない、けど入力値の想定をしていて、<code>idx_one_symbols</code>がソートされていて、小さいものから順番に出てくるものとしてます。関数作って、チェックすべきかな？</p>

<p>で、指定された場所の最後のものが入力文字列よりも大きいかどうかというチェックもしています。（あー、テストケース書いてないな）この辺りのせいでちょっと長めになってます。</p>

<p>単語の配列を作るのは03の時と同じやり方です。
回しかたがちょっと違って、<code>.iter().enumerate()</code>で回して、添字と値をタプル？でとりだしてます。添字を見ながら1文字取り出すのか、2文字取り出すのかの判断が必要だからです。あとは一緒ですね。1文字取り出すときは、<code>.first()</code>を使って見ました。
実は、2文字取り出す時と、1文字の時と同じロジック使った方が共通化できて、短くなった？？？</p>

<p>ということで、こんな感じでした。いつものようにツッコミお待ちしてます。</p>

<h3>所感</h3>

<p>問題それぞれについてではなく、
やってて思ったのですが、問題に対して想定される結果が記載されていると嬉しいなと思いました。
ロジックについては、各自実装者に寄ったり、言語によって違いが出たりするし、議論するベースになっていいかなと思うんですが、
問題で想定されている結果（出力）があると、自分の実装にケアが足りないところがないのか？とか、ケアしなくていい点とかがわかるのかもなぁと。
ユニットテスト相当のものがあると楽かなぁと。</p>

<p>このケースどうするんだろ？みたいなのが、ところどころコメントに残ったりしてます。
出題の意図としては、その部分も議論の対象ということなのかな？</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[第1章の00から02までやってみた（言語処理100本ノック）]]></title>
    <link href="http://blog.johtani.info/blog/2018/02/15/nlp100-ch01-00to02/"/>
    <updated>2018-02-15T21:59:01+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/02/15/nlp100-ch01-00to02</id>
    <content type="html"><![CDATA[<p>「鉄は熱いうちに打て」ということで、言語処理100本ノックの第1章の00から02を実装してみました。</p>

<!-- more -->


<p>さて、これが効率がいいのかどうかはさておき。</p>

<h3>00. 文字列の逆順</h3>

<p>問題は<a href="http://www.cl.ecei.tohoku.ac.jp/nlp100/#sec00">こちら</a>。</p>

<p>最初、<a href="https://github.com/johtani/nlp100-rust/blob/48567d107511541d0401af4ef58c6abb98a6083b/src/chapter01/answer.rs">Vecのreverse()で逆順にして0からlen()まで回してた</a>んですが、pop()がいい感じに後ろから取れることがわかったんで、切り替えました。
シンプルかな？</p>

<script src="http://gist-it.appspot.com/http://github.com/johtani/nlp100-rust/blob/ccbdf272adbb5aa738dc73e78e3667e4300a49c1/src/chapter01/answer.rs?slice=2:12"></script>


<h3>01. 「パタトクカシーー」</h3>

<p>問題は<a href="http://www.cl.ecei.tohoku.ac.jp/nlp100/#sec01">こちら</a>。</p>

<script src="http://gist-it.appspot.com/http://github.com/johtani/nlp100-rust/blob/ccbdf272adbb5aa738dc73e78e3667e4300a49c1/src/chapter01/answer.rs?slice=14:24"></script>


<p>1文字ずつ取り出して、インデックスの番号が2で割ってあまりが0なら文字列に追加していくってのでやってみました。
（ブログ書いてるところで、<code>i in 0..char_array.len()</code>じゃなくて、<code>(i, x) in char_array.iter().enumerate()</code>に切り替えました。）
matchとか使って綺麗に書けたりするのかなぁ？</p>

<h3>02. 「パトカー」＋「タクシー」＝「パタトクカシーー」</h3>

<p>問題は<a href="http://www.cl.ecei.tohoku.ac.jp/nlp100/#sec02">こちら</a>。</p>

<script src="http://gist-it.appspot.com/http://github.com/johtani/nlp100-rust/blob/ccbdf272adbb5aa738dc73e78e3667e4300a49c1/src/chapter01/answer.rs?slice=26:56"></script>


<p>だいぶ思考錯誤してる感じがソースに現れてます。
とりあえず、両方の文字列をcharsの配列にして個々のイテレータを回しながら、next()の戻り値があれば追加していく感じにして、
終了条件が両方Noneを通ったらにしてるけど、、、
なんか、もっと綺麗にできないのかなぁ。。。
next()のタプル返す関数作って、とかでなんかできたりするかなぁ？</p>

<h3>gist-it</h3>

<p>関係ないですが、GitHubのコードを貼り付けるのに便利なサービスがあるみたいです。</p>

<p><a href="http://gist-it.appspot.com">http://gist-it.appspot.com</a></p>

<p>これほんと便利だな。行数指定もできるし。
説明するのが簡単だ。</p>

<p>とりあえず、今日はこの辺まで。なんか、いい知恵あれば教えてください！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[言語処理100本ノックはじめました(Rust)]]></title>
    <link href="http://blog.johtani.info/blog/2018/02/14/start-nlp100-with-rust/"/>
    <updated>2018-02-14T19:52:31+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/02/14/start-nlp100-with-rust</id>
    <content type="html"><![CDATA[<p>ども。新しいもの始めないと頭が退化する。。。ということで、こちら（
<a href="http://blog.katsyoshi.org/blog/2018/01/16/happy-new-year-and-new-language/">happy new year and new language - katsyoshiのめもみたいなもの</a>）のブログに触発されて、言語処理100本ノックをはじめてみました。</p>

<!-- more -->


<p><a href="http://www.cl.ecei.tohoku.ac.jp/nlp100/#ch1">言語処理100本ノック</a>とは、自然言語処理になるのかな、東北大学の研究室の先生が公開している言語処理に関する実践的な課題をベースにプログラミングなどのスキルを学んでいくための問題集です。
元々はPythonを対象とされているようですが、Rustでやってみようかと。
まぁ、先ほどあげたブログの二番煎じです。。。
ちなみに、インスパイアされた元のブログの方はRust book 2nd editionを読み終えたらしいですが、私はかじった程度です（ダメかも？）。</p>

<p>NLPもRustもかじった程度なので、苦戦しそうですが、ちょっとずつやっていこうかなと。
ということで、準備運動の第1章から始めようかと。
GitHubにちょっとずつあげていく予定です。
<a href="https://github.com/johtani/nlp100-rust">https://github.com/johtani/nlp100-rust</a></p>

<p>まぁ、まずは宣言のブログを書いてみただけです。
続いてなかったら、叱咤激励してください。叱咤だけかも？</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Analyze UIとKibanaのプラグインの作成方法（第2回）]]></title>
    <link href="http://blog.johtani.info/blog/2018/02/09/getting-started-template-kibana-plugin/"/>
    <updated>2018-02-09T18:17:37+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/02/09/getting-started-template-kibana-plugin</id>
    <content type="html"><![CDATA[<p>第1回では、<a href="https://github.com/johtani/analyze-api-ui-plugin">Analyze UIというプラグイン</a>の紹介をしました、ごく簡単にですが。</p>

<p>第2回では、Kibanaのプラグインの作成方法を順を追って見ていこうと思います。今回は、プラグインのプロジェクトの作り方を説明します。
どんなファイルがあるのかなどについては第3回で説明します（2018/02月現在の方法になります。残念ながら、Kibanaのプラグイン作成自体はまだExperimentalな話になっていますので、変更がある可能性があります）。</p>

<!-- more -->


<p>実はそれほど難しいというわけではありません。Kibanaのプラグインを作成するためのテンプレートが用意されています。<a href="https://github.com/elastic/template-kibana-plugin/">template-kiban-plugin</a>です。
テンプレートのリポジトリのREADMEに作業手順の記載があります。</p>

<ol>
<li>KibanaのリポジトリをClone、Checkout</li>
<li>Node.jsの環境を用意する</li>
<li>Kibanaを起動できるようにする</li>
<li>SAOのインストール</li>
<li>テンプレートによるプロジェクトファイルの生成</li>
</ol>


<p>順を追って説明します。
<code>PLUGIN_DEV_DIR</code>というディレクトリ配下で作業をしている想定になります。</p>

<h2>1. KibanaのリポジトリをClone、Checkout</h2>

<p>開発環境として、Kibanaが必要です。Kibanaのプラグインを作るので。
手順などは<a href="https://github.com/elastic/kibana/blob/6.2/CONTRIBUTING.md#contributing-code">KibanaのCONTRIBUTING.md</a>に記載があります。
ということで、まずはKibanaのリポジトリをCloneします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd PLUGIN_DEV_DIR
</span><span class='line'>git clone git@github.com:elastic/kibana.git</span></code></pre></td></tr></table></div></figure>


<p>このままだと、masterブランチなので、開発したい対象のKibanaのバージョンのブランチもしくはタグをcloneします。今回は6.2.1向けということで、次のようになります。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git checkout v6.2.1</span></code></pre></td></tr></table></div></figure>


<p>これで、ソースが6.2.1向けになりました。</p>

<h2>2. Node.jsの環境を用意する</h2>

<p>Node.jsをインストールします。
Kibanaのリポジトリに<code>.node-version</code>というファイルがあります。
こちらにNode.jsのバージョンが記載されています。
Kibanaが使用しているNode.jsを利用できるようにします。ローカルでは<a href="https://github.com/creationix/nvm#installation">nvm</a>利用してインストールしました。後から、切り替えが可能だからです。
nvm自体のインストールについては<a href="https://github.com/creationix/nvm">nvmのサイト</a>をご覧ください。
nvmがインストールできたら、次のコマンドで、Kibanaが使用しているバージョンをインストールします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd kibana
</span><span class='line'>nvm install "$(cat .node-version)"</span></code></pre></td></tr></table></div></figure>


<p>すでにnvmを利用している場合などは、Kibana起動時にKibanaのバージョンに合わせたNode.jsに切り替えるようにしてください。</p>

<h2>3. Kibanaを起動できるようにする</h2>

<p>Kibanaでは<a href="https://yarnpkg.com/lang/en/">yarn</a>というjavascript向けのパッケージマネージャーを利用して起動やビルドなどを行います。まずはyarnをインストールします。<a href="https://github.com/elastic/kibana/pull/15485">最近npmからyarnに切り替えた</a>ようです。
私はMacだったので、<a href="https://yarnpkg.com/en/docs/install">brewでインストール</a>しました。
インストールできたら、次のコマンドを実行します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yarn</span></code></pre></td></tr></table></div></figure>


<p>これにより、package.jsonから必要なライブラリなどをダウンロードして来てくれます。
問題なければ「✨  Done in 439.30s.」というような表示がされます（結構時間かかりますね）。
では、Kibanaを起動できるか確認してみましょう。
さらに、Elasticsearchも起動してみます。
Kibanaのpackage.jsonの中にはElasticsearchを起動するためのスクリプトも用意されています。実際には<a href="https://gruntjs.com">grunt</a>を利用してタスクを実行しているようです。Elasticsearchの起動にはJavaが必要になります。
今回は6.2.1なので、JDK 8以降がインストールされている必要があります。
こちらはインストールされているものとします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yarn elasticsearch</span></code></pre></td></tr></table></div></figure>


<p>で起動できます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;&gt; Started 1 Elasticsearch nodes.</span></code></pre></td></tr></table></div></figure>


<p>という表示が出てればOKです。
次にKibanaです。別のTerminalを起動して、以下のコマンドで起動できます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yarn start</span></code></pre></td></tr></table></div></figure>


<p>これだけです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server    log   [06:58:56.930] [info][listening] Server running at http://localhost:5603</span></code></pre></td></tr></table></div></figure>


<p>この辺りが出てればKibanaのServerは起動済みです。また、Elasticsearchに接続できていれば、次のログが出ているはずです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server    log   [07:02:18.010] [info][status][plugin:elasticsearch@6.2.1] Status changed from red to green - Ready</span></code></pre></td></tr></table></div></figure>


<p>Elasticsearch接続用のKibanaのプラグインの状態になります。
これで、Kibanaの環境が整ったことが確認できました。
もちろん、Elasticsearchに関しては、yarnで起動せずに、tar.gzなどでダウンロードして来たElasticsearchを起動しておき、アクセスするといったことも可能です。プラグインなどをElasticsearchにもいれてテストしたい場合などはそちらの方が便利かもしれません。</p>

<h2>4. SAOのインストール</h2>

<p>では、一度、ElasticsearchとKibanaを停止しましょう。フォワグラウンドで起動しているので、それぞれのTerminalでCtrl+Cで停止できます。
Kibanaのプラグイン作成むけに、テンプレートが作られています。<a href="https://sao.js.org">sao.js</a>というGitHubのリポジトリやnpmのパッケージをテンプレートとして使うことができるツールを利用してプラグインのプロジェクト（リポジトリ）を作成します。
実際にテンプレートとなるリポジトリは<a href="https://github.com/elastic/template-kibana-plugin">template-kibana-plugin</a>になります。
まずはSaoのインストールです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm install -g sao</span></code></pre></td></tr></table></div></figure>


<p>プラグインのテンプレートのページには上記のようにnpmを利用したインストール方法になっていますが、次のようにyarnでも可能です。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yarn global add sao</span></code></pre></td></tr></table></div></figure>


<p>これで、saoがインストールできました。</p>

<h2>5. テンプレートによるプロジェクトファイルの生成</h2>

<p>あとは、テンプレートを元にプロジェクトを作成します。
<code>PLUGIN_DEV_DIR</code>ディレクトリ配下に、kibanaと同じ階層で作成するプラグイン用のディレクトリを作成します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir simple-sample-kibana-plugin</span></code></pre></td></tr></table></div></figure>


<p>以下のような構成になります。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kibana                      simple-sample-kibana-plugin</span></code></pre></td></tr></table></div></figure>


<p>次にテンプレートを適用していきます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd simple-sample-kibana-plugin
</span><span class='line'>sao kibana-plugin@7.2.4</span></code></pre></td></tr></table></div></figure>


<p>2行目がsaoを利用してプロジェクトを作成しているコマンドになります。
すると、次のような質問が出て来ます。
これらに答えるとプロジェクトに必要なファイル（package.jsonやREADME.mdなど）に入力した情報を適用したものを作ってくれます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>? Name of your plugin?
</span><span class='line'>? Provide a short description
</span><span class='line'>? What Kibana version are you targeting?
</span><span class='line'>? Should an app component be generated?
</span><span class='line'>? Should translation files be generated?
</span><span class='line'>? Should an hack component be generated?
</span><span class='line'>? Should a server API be generated?</span></code></pre></td></tr></table></div></figure>


<p>実際に答えた内容はこちら。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>? Name of your plugin? simple-sample-kibana-plugin
</span><span class='line'>? Provide a short description Sample plugin for explaining how to make kibana app
</span><span class='line'>? What Kibana version are you targeting? 6.2.1
</span><span class='line'>? Should an app component be generated? Yes
</span><span class='line'>? Should translation files be generated? Yes
</span><span class='line'>? Should an hack component be generated? Yes
</span><span class='line'>? Should a server API be generated? Yes</span></code></pre></td></tr></table></div></figure>


<p>プラグインの名前などは、ディレクトリ名と同じものを入力補完してくれているので、そのままEnterでもOKです。
Descriptionについてはわかりやすいものを入力しましょう。
バージョンは、先ほどのKibanaのリポジトリに合わせて、<code>6.2.1</code>にしてあります。
あとは、作るプラグインの種類に応じて、必要なコンポーネントを作るかどうかの質問にYes/Noで答えます。
今回はサンプルの説明ということもあるので、全てYesで答えました。
ちなみに、私が実際に作成した<a href="https://github.com/johtani/analyze-api-ui-plugin/">analyze-api-ui-plugin</a>では、<code>app</code>と<code>translation</code>と<code>server</code>の3つを作成しました。
ただし、<code>translation</code>については現在はテンプレートで作成したままのファイルが入っており、実際には利用してないです。</p>

<p>完了したら、プラグインのサンプル入りのプロジェクトが完成です。
もう一度、Elasticsearchを立ち上げて、プラグインのプロジェクトからKibanaを起動してアクセスしてみます。まずは、<code>PLUGIN_DEV_DIR/kibana</code>ディレクトリの下で、Elasticsearchを起動します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yarn elasticsearch</span></code></pre></td></tr></table></div></figure>


<p>次に、<code>PLUGIN_DEV_DIR/simple-sample-kibana-plugin</code>ディレクトリの下で、以下のコマンドを実行し、プラグインが入った状態のKibanaを起動します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yarn start</span></code></pre></td></tr></table></div></figure>


<p>問題なく起動すれば、ブラウザでアクセスすると次のような画面が表示されるはずです。</p>

<p><img src="http://blog.johtani.info/images/entries/20180214/sample_start.jpg" width="800"></p>

<p>左側にメニューが1つ増えています。
クリックすると、上記画像のような画面が表示されるはずです。</p>

<p>これで、カスタムプラグインの開発ができる環境ができました！
次回は、プロジェクトのディレクトリ構成や、どんなツールが内部で使用されてデータのやり取りが行われているかについて説明します。お楽しみに。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Analyze UIとKibanaのプラグインの作成方法（第1回）]]></title>
    <link href="http://blog.johtani.info/blog/2018/01/19/how-to-make-kibana-plugin-example-analysis-ui/"/>
    <updated>2018-01-19T15:36:46+09:00</updated>
    <id>http://blog.johtani.info/blog/2018/01/19/how-to-make-kibana-plugin-example-analysis-ui</id>
    <content type="html"><![CDATA[<p>あけましておめでとうございます。今年はサボりがちだったブログをちょっとずつ復活させようかと。
ということで、第1弾として、昨年少し作っていたKibanaのプラグインを何度かに分けて紹介したいと思います。</p>

<p>今回は<a href="https://github.com/johtani/analyze-api-ui-plugin">Analyze UIというプラグイン</a>の紹介です。</p>

<!-- more -->


<p>今回はインストール方法と簡単な機能紹介です。
細かな紹介は個別にやりたいと思います。</p>

<h3>Analyze UI pluginとは？</h3>

<p>Elasticsearchの<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-analyze.html"><code>_analyze</code>というAPI</a>(個人的に好きなAPIです)をご存知でしょうか？</p>

<p>Elasticsearchは全文検索エンジンで、データの検索には<a href="https://ja.wikipedia.org/wiki/%E8%BB%A2%E7%BD%AE%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9">転置インデックス</a>というものを使用します。
Elasticsearchにデータを登録する際に、<code>text</code>型のデータの場合、この転置インデックスのキーとなる単語を決める処理のことを<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html">Analysis</a>と呼びます（Analysisの詳細については割愛します。後日説明するかも？）。
このAnalysisの処理が、入力されたデータの文字列に対してどのように行われて、結果としてどんな単語がキーとして用いられているかを確認できる機能が<code>_analyze</code> APIです。検索で単語がうまくヒットしないな？とか、なんで、こんなので検索結果に出てくるんだ？といった場合、このAPIを利用すると、どのような単語で転置インデックスが作られているかがわかるので、検索にヒットしない/する理由を見つけることができます。</p>

<p>Elasticsearchの便利な点はRESTfulなAPI＋JSONでやりとりができる点なのですが、<code>_analyze</code> APIの結果をJSONで受け取っても、見るのにちょっと苦労します。。。こんな感じ。</p>

<p>リクエスト：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>POST _analyze
</span><span class='line'>{
</span><span class='line'>  "analyzer": "kuromoji",
</span><span class='line'>  "text": "今年はブログをいっぱい書きますよ！"
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>レスポンス：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  "tokens": [
</span><span class='line'>    {
</span><span class='line'>      "token": "今年",
</span><span class='line'>      "start_offset": 0,
</span><span class='line'>      "end_offset": 2,
</span><span class='line'>      "type": "word",
</span><span class='line'>      "position": 0
</span><span class='line'>    },
</span><span class='line'>    {
</span><span class='line'>      "token": "ブログ",
</span><span class='line'>      "start_offset": 3,
</span><span class='line'>      "end_offset": 6,
</span><span class='line'>      "type": "word",
</span><span class='line'>      "position": 2
</span><span class='line'>    },
</span><span class='line'>    {
</span><span class='line'>      "token": "いっぱい",
</span><span class='line'>      "start_offset": 7,
</span><span class='line'>      "end_offset": 11,
</span><span class='line'>      "type": "word",
</span><span class='line'>      "position": 4
</span><span class='line'>    },
</span><span class='line'>    {
</span><span class='line'>      "token": "書く",
</span><span class='line'>      "start_offset": 11,
</span><span class='line'>      "end_offset": 13,
</span><span class='line'>      "type": "word",
</span><span class='line'>      "position": 5
</span><span class='line'>    }
</span><span class='line'>  ]
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>このくらいの量であればまだなんとかなりますが、文章が長くなると辛いですよね。</p>

<p>ということで、GUIがあると便利だろうなぁと。で、作ってみましたというのが今日紹介するKibana用のAnalyze UIプラグインです。
こんな感じで、Kibanaのアプリの一部として動作しブラウザ上で、入力テキストの文字列がどのようにanalyzeされて、単語になるかがわかります。</p>

<p><img src="http://blog.johtani.info/images/entries/20180119/analyze_ui_sample_1.jpg" width="800"></p>

<p>（先ほどのAPIのサンプルと同じものを画面で入力した結果になります）。</p>

<h3>インストール方法</h3>

<p>現時点の最新版Kibana（6.1.2）に対応しています。
Kibanaのディレクトリで<code>kibana-plugin</code>コマンドを利用してインストールします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./bin/kibana-plugin install https://github.com/johtani/analyze-api-ui-plugin/releases/download/6.1.2/analyze-api-ui-plugin-6.1.2.zip</span></code></pre></td></tr></table></div></figure>


<p>これだけです。
で、Kibanaを起動していただくと、左のメニューに「Analyze UI」という項目が増えています。</p>

<p><img src="http://blog.johtani.info/images/entries/20180119/kibana_menu.jpg" width="400"></p>

<p>クリックすると、Analyze UIが表示されます。</p>

<p>初期画面は入力された文字を特定のAnalyzerで処理した場合の結果を見るための画面です。綱目の説明は画像をご覧ください。</p>

<p><img src="http://blog.johtani.info/images/entries/20180119/intro_analyze_ui_1.jpg" width="800"></p>

<p>先ほどのJSONよりは見やすくなったかと思います。
そのほかにもいくつか画面や機能があるのですが、今日はこの辺りで。
「<code>_analyze</code> API便利なんだけど、JSONは。。。」とか「検索うまくできないなぁなんでだろう？」と思っている方は、ぜひ試して見ていただければと。
問題点などありましたら、GitHubのIssueを登録してください。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[今年の振り返りと来年の抱負（2017）]]></title>
    <link href="http://blog.johtani.info/blog/2017/12/31/looking-back-2017/"/>
    <updated>2017-12-31T21:30:43+09:00</updated>
    <id>http://blog.johtani.info/blog/2017/12/31/looking-back-2017</id>
    <content type="html"><![CDATA[<p>今年は紅白を見ながら書いてます。
今年はいろんなところに出張に行ったなぁ。</p>

<!-- more -->


<h2>振り返り（2016年に書いた抱負から）</h2>

<p>まずは去年の抱負を元に。</p>

<h5>もちろん英語の継続</h5>

<p>もちろん継続してます。英会話しながら海外TVドラマや映画を見てます。
ちょっとずつ英語字幕でも見ようとしてますが、まだまだだなぁ。
あと、TOEICを受けてないんで、それは受けないと。
見たドラマはこの辺です。</p>

<ul>
<li>ER</li>
<li>ウォーキング・デッド</li>
<li>Agent of Shield</li>
<li>SUITS</li>
<li>Mr.Robot(いまいち話の展開についていけなかった)</li>
</ul>


<h5>継続的にイベントに登壇</h5>

<p>OSCに今年もブース出してセッション持ってました。
勉強会ももちろんやりました。
あと、外部のカンファレンス（FOSS4G、BigData Analytics、db tech showcaseなど）や
勉強会(monitoring勉強会やCA.ioなど)にも登壇させていただきました。
もっと外部から読んでいただいたり、CfPに応募して通過できるようにしないとなぁ。</p>

<h5>もっと開発＆ブログ</h5>

<p>ブログはすみません。。。来年頑張ります。。。
ブログの代わりに<a href="https://www.amazon.co.jp/dp/477419218X?tag=johtani-22&amp;camp=243&amp;creative=1615&amp;linkCode=as1&amp;creativeASIN=477419218X&amp;adid=1MB8R50WWEJ3JC8VXN60&amp;">書籍</a>を出せました。データ分析基盤系の書籍になるので、興味のある方はのぞいて見ていただければ。</p>

<p>開発はちょっとやってます。今年後半はKibanaのプラグインとかをちょっと書いてました。
Ingest-CSVもちょこちょこバージョンアップに追従してたりします。</p>

<h5>サポートエンジニア獲得！</h5>

<p>獲得しました！（自分の成果かどうかはわかりませんが。。。）
今は3名体制でサポートしてもらってます。おかげさまでだいぶサポートする機会が減ってきました。
開発は<a href="https://www.elastic.co/about/careers">世界各地どこでも募集中</a>だったりしますので、ぜひ連絡いただければと。</p>

<h5>個人的な検索勉強会の再開</h5>

<p>再開しました。<a href="http://amzn.to/2CmYcw9">検索エンジン自作入門</a>を知人と隔週くらいで読んでます。読んでるだけではあれなんで、実装もしてたり。全然違う言語でトライして見ようと思ったのでRustで書き始めてます。まずは、単純なところからと思ったんですが、
Rustの書き方の違いにだいぶ戸惑ってます。。。</p>

<h2>振り返り(今年あったできごと)</h2>

<p>ここからは今年の出来事を。</p>

<ul>
<li>初アメリカで釣り</li>
<li>Nintendo Switch!</li>
<li>初Japanチームオフサイト</li>
<li>チーム変更</li>
<li>初Berlin Buzzword!</li>
<li>母校（大学）訪問</li>
<li>Kibanaプラグイン開発</li>
</ul>


<p>今年も初モノがちらほらとありますね。
今年もカレンダー振り返ってたら「え？これ今年だったの？」ってのがちらほらありました。。。</p>

<p>アメリカで釣りやりました。自社のカンファレンスElastic{ON}のあとに、エンジニアが集まるミーティングがあるんですが、そこで1日Fun Dayがあって、そこで釣りをやりました。
魚群探知機とかで魚探すんですね、最近のは。2、3匹釣ったので非常に楽しかったです。
来年はスノーシューにチャレンジする予定。</p>

<p>Nintendo Switch買って、ゼルダやりました。今はイカやってます。
イカ欲はちょっと減ってるかもなぁ、1に比べると。
あとは、子供に買ったマリオやったりしてるかな。</p>

<p>ここ10年くらい行きたいと思っていたカンファレンス、<a href="https://berlinbuzzwords.de">Berlin Buzzword</a>に行ってきました！
これが今年一番嬉しかった出来事です。Luceneコミッターの方々にも会えたし。特にPoliceman JenkinsのUweさんに会えたのが本当に感激でした。。。
来年も行けるといいなぁ。。。</p>

<p>今年も出張が多めだったのであちこち飛び回ってたなぁ。
そんな飛び回っている中で、故郷である広島（出身地？）に出張で行ったので、母校に顔を出してきました。
変わってなかった。。。自分が一期生なので、自分が入学した時はまだクレーンとか立ってるような新校舎だったんだけど、それが20年くらい経て、だいぶ古くなってました。。。
広島市内は港近くに高速道路とか出ててだいぶ様変わりしてました。
ただ、小学校も高校も変わってなかったなぁ。久々に高校の同級生にも会えたし。
また、機会があればぜひ行きたいなと。帰省する場所ではなくなったので、行く機会がないんですよね。。。</p>

<p>開発もちょっとやってます。Kibanaのプラグインに挑戦して見てます。
いまだにJavaScriptは苦手なんですが。。。
ちょっとずつ改良して、ひょっとすると本体とかに取り込めるかな？
あとは、今年始めたRustをちょっとずつ継続して行きたいなと。</p>

<h2>来年の抱負</h2>

<p>最後は来年の抱負を。</p>

<ul>
<li>もっと英語の継続＆TOEIC</li>
<li>継続的にイベントに登壇</li>
<li>CfPもっと出すぞ！</li>
<li>もっとブログ！</li>
<li>雑誌やWeb系雑誌で記事を。</li>
<li>コミュニティを別の方法で盛り上げ</li>
<li>Elasticsearchなど検索系の開発にも参加</li>
</ul>


<p>英語はもちろんですね。今年は12月の自社イベントに合わせて多くのAPJチームの人が来て、
チームで会話できたし、もっと英語やらないとなぁと。前よりもちょっとは喋れるようになった気がしてます（気がしてるだけで、喋れてるかどうかは不明）。あとは、TOEIC受けて、実力チェックしてみないとなぁ。</p>

<p>イベント登壇はまぁ、DevRelですから、一応。
来年もとりあえず、3月までは毎月どこかでブース出してます。
Ask Me Anything的なブースの出し方を今年はしてみようかなと思ってるので、
ちょっと使い始めたけど、この辺よくわからないと思ってる方、ぜひ質問しに来てください。
ブース出すだけじゃなくて、スピーカーとしていろんな場所で喋れるようにしないとなぁと。
もっと幅広く知ってもらえるように雑誌とかで連載できるようにしたいなぁと思ってます。
また、日本語の入り口の情報を増やすためにブログも書かないとなぁ。</p>

<p>勉強会も継続しますが、別の方法でも盛り上げて行きたいなぁと。
勉強会はどうしても聞く人が多くて、ユーザーの間での交流や情報交換とまでは行ってない気がするし、<a href="http://discuss.elastic.co">discuss.elastic.co</a>というフォーラムで質問は増えて来てるけど、もう少し交流しやすい場があると使ってもらえるかなぁ？と思っていたり。
何かおすすめとかあれば、連絡ください。
meetup.comの勉強会のページにも掲示板はついてるんだけど交流しにくそうだし。</p>

<p>来年は自分が最も興味のある検索系の開発にも参加したいなぁと。
Elasticsearchをちょっとずつ時間見つけてやってたりはしますが、もう少し首を突っ込んで行きたいなぁと。<a href="http://blog.johtani.info/blog/2017/11/10/welcome-swiftype/">Swiftype</a>もジョインしたし。もっと検索やって行きたい気持ちが強いので。</p>

<p>さて、ということで、今年もあと1時間なくなりました。
今年も様々な面で色々な方々に助けていただけました。本当にお世話になりました。
この場を借りてお礼申し上げます。</p>

<p>来年ももちろん、色々な方に助けてもらうと思いますが、よろしくお願いいたします！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2018年のElasticは？]]></title>
    <link href="http://blog.johtani.info/blog/2017/12/24/elastic-2018/"/>
    <updated>2017-12-24T23:10:16+09:00</updated>
    <id>http://blog.johtani.info/blog/2017/12/24/elastic-2018</id>
    <content type="html"><![CDATA[<p>Merry Christmas!
<a href="https://qiita.com/advent-calendar/2017/elasticsearch">Elastic Stack Advent Calendar 2017</a>の24日目の記事になります。</p>

<p>ちょっとですが、2018年のElasticについて書いてみようかと思います。</p>

<!-- more -->


<h2>イベント</h2>

<p>いくつか出展が決まっているイベントがあるのでまずは宣伝を。</p>

<h4>OSC Osaka 2018</h4>

<p>まずは、1月25日、26日に<a href="https://www.ospn.jp/osc2018-osaka/">OSC Osaka 2018</a>に出展し、話をします。参加者がいそうであれば、25日や26日の夜に勉強会もありかなぁと思っています。
セッションでは入門的な話をする予定です。ブースにいますので、色々質問がある関西の方はぜひご参加ください。</p>

<h4>Developer Summit 2018</h4>

<p>2月15日、16日は<a href="http://event.shoeisha.jp/devsumi/20180215">Developer Summit 2018</a>に出展します。
こちらでもブースにいますので、AMA（Ask Me Anything）的に使っていただくのもいいかなと。
デブサミに参加される方はぜひお立ち寄りください。</p>

<h4>Manabiya</h4>

<p>3月23日、24日は<a href="https://manabiya.tech">Manabiya</a>に出展します。
こちらでもAMAのつもりでブースを出す予定です。質問がある方はぜひお立ち寄りください。
こちらのイベントは初めての開催になるようなので、どんなイベントになるか楽しみにしています。</p>

<p>イベント回りはこの辺りで。
また、1月末に勉強会を予定しています。決まり次第また<a href="https://www.meetup.com/ja-JP/Tokyo-Elastic-Fantastics/">Meetup.com</a>の方々にメールを出す予定です。</p>

<h2>Elastic Stackの2018年は？</h2>

<h4>Canvas!</h4>

<p>昨年のElastic{ON}でみなさんをCanvasがリリースされるかなぁと。
現在、みなさんにテストしてもらえるように<a href="http://canvas.elastic.co">canvas.elastic.co</a>というサイトを公開中で、実際にインストールして試すことができるようになっています。
ぜひ、触って、全く新しいUIを体験して見てください。</p>

<h4>SQL?</h4>

<p>こちらも昨年のElastic{ON}でみなさんから反響があったものです。
もう直ぐでてくるのではないかなぁと。</p>

<h4>その他は？</h4>

<p>いくつか面白そうで、取り込み済みのものをピックアップしておきます。</p>

<ul>
<li><a href="https://github.com/elastic/elasticsearch/pull/27478">Add ranking evaluation API</a>

<ul>
<li>検索クエリなどに対して検索結果のランクのクオリティを評価するためのAPIの追加（7.0予定）</li>
</ul>
</li>
<li>JDK9サポート？

<ul>
<li>6.2でサポートされそうです。が、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/setup.html#jvm-version">LTSのJDK8が推奨のままの予定</a>です。</li>
</ul>
</li>
<li>High-level REST ClientでいくつかAPIが追加

<ul>
<li><a href="https://github.com/elastic/elasticsearch/pull/27574%E3%80%81https://github.com/elastic/elasticsearch/pull/27351">https://github.com/elastic/elasticsearch/pull/27574%E3%80%81https://github.com/elastic/elasticsearch/pull/27351</a></li>
</ul>
</li>
<li>APM正式リリース？

<ul>
<li><a href="https://www.elastic.co/jp/solutions/apm">ベータ版</a>がリリースされているので、秒読み段階？</li>
</ul>
</li>
</ul>


<h2>ということで</h2>

<p>より詳しく知りたい方は、サンフランシスコで開催される<a href="https://www.elastic.co/elasticon/conf/2018/sf">Elastic{ON} 2018</a>に参加するのが一番です！（ステマ）
私も参加予定ですので、ぜひ、現地でお会いし、色々な情報をゲットしましょう。</p>

<p>明日で、今年のAdvent Calendarも最後です。micci184さんの記事を楽しみにしましょう！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2017年のElastic StackとElastic]]></title>
    <link href="http://blog.johtani.info/blog/2017/12/01/whats-happen-at-elastic-in-2017/"/>
    <updated>2017-12-01T00:00:00+09:00</updated>
    <id>http://blog.johtani.info/blog/2017/12/01/whats-happen-at-elastic-in-2017</id>
    <content type="html"><![CDATA[<p><a href="https://qiita.com/advent-calendar/2017/elasticsearch">Elastic stack (Elasticsearch) Advent Calendar 2017</a>の1日目の記事になります。</p>

<p>まだ、1ヶ月を残していますが、簡単に今年起こったことを振り返ってみようかと思います。思った以上に色々ありましたね。。。</p>

<!-- more -->


<h3>Elastic Stack 5.2.0リリース (1月)</h3>

<p><a href="https://www.elastic.co/jp/blog/elastic-stack-5-2-0-released">リリース記事はこちら</a></p>

<p>HeatmapがKibanaで追加されたり、Heartbeatがベータですが追加されました。
個人的には、Terms aggregationの<a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.2/search-aggregations-bucket-terms-aggregation.html#_filtering_values_with_partitions">Filtering Valuesによるパーティション</a>が便利になったと思います。Terms Aggsでページングに似たことができるようになりました。</p>

<h3>Elastic{ON}17開催 (3月)</h3>

<p>第3回目のユーザカンファレンスが開催されました。
バレーダンサーの踊りから始まったキーノート、様々なユーザ企業によるユースケース発表などいろいろありました。
<a href="https://www.elastic.co/elasticon/conf/2017/sf">セッションはこちらのサイトから</a>から録画を見ることができます。
<a href="https://www.elastic.co/elasticon/conf/2017/sf/elasticsearch-sql">SQL for Elasticsearch</a>やAwardが目を引いたと思います。SQL対応まだ出てきていないですが、もうすぐじゃないかと！</p>

<h3>Elastic Stack 5.3.0リリース (3月)</h3>

<p><a href="https://www.elastic.co/blog/elastic-stack-5-3-0-released">リリース記事はこちら</a></p>

<p><a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules-overview.html">Filebeat module</a>が導入され、ログファイルを取り込んでKibanaで可視化するまでの手順がより簡単になりました。Elasticの目指しているものの一つに、シンプルな使い方、簡単にはじめられることといったものがあります。KibanaのTimepickerもより便利になったのも、このバージョンからです。</p>

<h3>ShayがCEOに (5月)</h3>

<p>2月にすでに発表されていましたが、Elasticsearchの生みの親のShay BanonがCEOに正式に就任しました。CEOになってさらに、精力的に様々なことをやっていて、本当にすごいなと思います。</p>

<h3>Elastic Stack 5.4.0、6.0.0-alpha1リリース (5月)</h3>

<p><a href="https://www.elastic.co/blog/elastic-stack-5-4-0-released">5.4.0リリース記事はこちら</a>、<a href="https://www.elastic.co/blog/elastic-stack-6-0-0-alpha1-released">6.0.0-alpha1リリース記事はこちら</a></p>

<p>5.4.0は節目になるリリースでした。Machine Learningがベータリリースとして、X-Packに追加されましたし、ElasticsearchではCross Cluster Searchの改善が進みました。LogstashではPersistent QueueがGAになりましたし、KibanaにはTime Series Visual BuilderやEvent Contextなどが追加されますます使いやすくなりました。</p>

<p>また、6.0.0のalpha版も同時にリリースされ、様々な方からのフィードバックが集まり始めました。</p>

<h3>Elastic Cloud Enterprise GAリリース (5月)</h3>

<p>Elastic Cloudのバックエンドの技術を製品に採用したものになります。
多くのElasticsearchクラスタを管理しないといけない方には朗報でした。</p>

<h3>OpbeatがJoin (6月)</h3>

<p><a href="https://www.elastic.co/blog/welcome-opbeat-to-the-elastic-family">Opbeatチームがジョイン</a>したのが6月です。Elastic StackがAPM(Application Performance Monitoring)でも活躍することになりそうです。APMの仕組みとしては、APM Agentをアプリ側に配置し、APM Serverへデータを送信し、Elasticsearchに保存、Kibanaで可視化するという流れになります。</p>

<h3>Elastic Stack 5.5.0リリース (7月)</h3>

<p><a href="https://www.elastic.co/blog/kibana-5-5-0-released">リリース記事はこちら</a></p>

<p>Machime LearningがGAリリースになったのが5.5.0です。色々な方から質問を受けました。それ以外にも、ElasticsearchのWindows MSI InstallerやKibanaのFilter editorなどが追加されました。Filter editorはこれまで検索条件を記述するのが難しいと感じていたKibanaユーザにとても喜んでもらえたものじゃないかなと。
GrokDebuggerが導入されたのもこのタイミングです。</p>

<h3>Elastic Stack 5.6.0リリース (9月)</h3>

<p><a href="https://www.elastic.co/blog/elastic-stack-5-6-0-released">リリース記事はこちら</a></p>

<p>5系最後のマイナーリリースであり、6へのアップグレードが楽になる様々な仕組みが用意されたのがこのバージョンです。ElasticsearchのJava High level REST clientが導入されたのもこのバージョンです。本当に様々な機能が次のメジャーバージョンとの互換性のために組み込まれています。。。</p>

<h3>Elastic Cloud on GCP (9月)</h3>

<p><a href="https://www.elastic.co/blog/announcing-the-ga-of-elastic-cloud-hosted-elasticsearch-on-google-cloud-platform-gcp">リリース記事はこちら</a></p>

<p>これまで、AWS上のみで展開していたElastic CloudがGCP上でも展開されることになりました。残念ながら、日本リージョンはまだありませんが、問い合わせなどが増えれば今後サポートされる可能性が高くなると思います！</p>

<h3>Elastic APM alpha (9月)</h3>

<p><a href="https://www.elastic.co/guide/en/apm/get-started/current/overview.html">リリース記事はこちら</a></p>

<p>OpbeatチームによりElastic StackのAPMがAlphaですがリリースされました。APMがOpen Sourceで利用できるんです！Agentがもっと増えてくると色々なことに使えるようになると思います。ぜひAgentを作成してみてください！</p>

<h3>Elastic Stack 6.0.0リリース (11月)</h3>

<p><a href="https://www.elastic.co/blog/elastic-stack-6-0-0-released">リリース記事はこちら</a></p>

<p>待ちに待った6.0.0のリリースです。<a href="https://events.elastic.co/6-0-elastic-stack-jp">新機能については本日(12/1)の昼に行われるウェビナーをご覧ください！</a></p>

<h3>SwiftypeがJoin (11月)</h3>

<p><a href="https://www.elastic.co/jp/about/press/elastic-acquires-saas-site-search-leader-swiftype">ニュースリリースはこちら</a></p>

<p>Swiftypeと呼ばれる検索のSaaSを提供している会社がジョインしました。
個人的には今年一番嬉しいニュースです。やはり、検索が好きなので。
簡単に<a href="http://blog.johtani.info/blog/2017/11/10/welcome-swiftype/">Site Searchを構築できる仕組み</a>は非常に面白いものです。
興味のある方は、ぜひ触ってみてください。日本語固有の機能などはまだないので、今後関わっていければなーと。</p>

<h3>Elastic{ON} Tour Tokyo開催 (12月)</h3>

<p>まだ開催前ですが、今年も<a href="https://www.elastic.co/elasticon/tour/2017/tokyo">東京で1dayイベントを開催</a>します。
残念ながら、もうSold outなので、キャンセル待ちになってしまっているみたいですが。私もスピーカーとして喋りますし、AMAブースにも立っています。
参加される方はぜひ声をかけていただければと思います。</p>

<h4>OSC 2017.Enterprise (12月)</h4>

<p>オープンソースカンファレンスで今年も様々な都市に出張しました。
今年の締めくくりということで、<a href="https://www.ospn.jp/osc2017.enterprise/">12/8に渋谷で開催されるカンファレンス</a>に出展します。時間のある方は、ぜひブースに遊びに来てください。入門者向けのセッションもあるので、こちらもお待ちしております。</p>

<h3>まとめ</h3>

<p>超駆け足ですが、今年を振り返ってみました。
今年もいろんなことがありました。書くのが大変だったw。
OSCなどイベントで声をかけていただいた皆様、ありがとうございました。</p>

<p>さて、<a href="https://qiita.com/advent-calendar/2017/elasticsearch">Elastic Stack Advent Calendar 2017</a>は始まったばかりです。これからの記事を楽しみにしています！</p>

<h4>ということで、</h4>

<p>次は<a href="https://qiita.com/aeroastro">aeroastroさん</a>の「Elasticsearchのインデックスを本当の意味で無停止再構築する方法」（<a href="https://qiita.com/advent-calendar/2017/elasticsearch">Advent Calendarのページはこちら</a>）になります、お楽しみに！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swiftypeがジョインしたので触ってみました]]></title>
    <link href="http://blog.johtani.info/blog/2017/11/10/welcome-swiftype/"/>
    <updated>2017-11-10T11:14:49+09:00</updated>
    <id>http://blog.johtani.info/blog/2017/11/10/welcome-swiftype</id>
    <content type="html"><![CDATA[<h1>Swiftypeでサイト内検索？</h1>

<p>プレスリリース：<a href="https://www.elastic.co/jp/about/press/elastic-acquires-saas-site-search-leader-swiftype">Elasticがサイト内検索サービス最大手のSwiftypeを買収</a>が出ましたが、SwiftypeチームがElasticにジョインしました！</p>

<h2>自分のブログ検索に導入してみる？</h2>

<p><a href="https://swiftype.com/">Swiftype</a>はSite Searchをサービスとして提供しています。
実際に指定したサイトのデータをクロールして、インデキシングし、検索できるようになります。
ものは試しということで、自分のブログを登録してみました。検索窓はつけてないですが。
14日間のFree trialがあるのでそちらで試してみましょう。
検索窓はデモとか作れたらかな。</p>

<!-- more -->


<h2>ということで、Free trialへ</h2>

<p>まずはユーザ登録です。Googleのアカウントと連携するか、Swiftypeにメルアドを登録するかが選択できます。
登録できたら、次にどちらのプロダクトを使うかという選択画面が出てきます。
今回はサイト検索して見たいので、「Site Search」の「START FREE TRIAL」をクリックします。</p>

<h2>Engineの指定</h2>

<p>Web Crawlerを利用するか、独自にSwiftypeのAPIを利用してデータを登録するかを選択します。</p>

<p><img src="http://blog.johtani.info/images/entries/20171110/01_Create_Search_Engine___Swiftype.jpg" title="" ></p>

<p>今回は、お手軽な方のCrawlerを選択します。
すると次に、クロールしたいURLの指定画面が出てきます。</p>

<p><img src="http://blog.johtani.info/images/entries/20171110/02_Create_Crawler-based_Search_Engine___Swiftype.jpg" title="" ></p>

<p>今回は自分のブログなので、&#8217;<a href="http://blog.johtani.info">http://blog.johtani.info</a>&#8216;を指定します。</p>

<p><img src="http://blog.johtani.info/images/entries/20171110/03_Create_Crawler-based_Search_Engine___Swiftype.jpg" title="" ></p>

<p>で少し待つと、URLのチェック（存在チェックとか、接続チェックとか）が終わり、今回作成するEngineに名前をつける画面が出てきます。
「My Blog search」という名前にしてみました。</p>

<p><img src="http://blog.johtani.info/images/entries/20171110/04_https___app_swiftype_com_engines_my-blog-search_precrawls_166127_settings.jpg" title="" ></p>

<p>sitemapがあるかどうかをCrawlerがチェックしています。
私のBlogはOctopressでできていて、sitemap.xmlも作ってくれているので、これを元にCrawlerはクロールをしてくれます。そのほかにも<a href="https://swiftype.com/documentation/crawler">RSSやAtomサポートもあるみたいですね</a>。
「COMPLETE SETUP」を押すと、Engineの管理画面が出てきます。</p>

<p><img src="http://blog.johtani.info/images/entries/20171110/05_My_Blog_search_Overview___Swiftype.jpg" title="" ></p>

<p>「CRAWLING」という表示が出ています。クロールしている最中です。これが終われば、「PREVIEW」に代わり、検索できる準備ができたことになります。
実際にPREVIEWして見ると、次のような検索ができるようになります。</p>

<p><img src="http://blog.johtani.info/images/entries/20171110/06_My_Blog_search_Overview___Swiftype_PREVIEW.jpg" title="" ></p>

<p>そのほかにはWeightの調整画面などもありますね。フィールド毎に重み付けを変えて見たりもできます。</p>

<p><img src="http://blog.johtani.info/images/entries/20171110/07_Weights___Swiftype.jpg" title="" ></p>

<p>日本語独自のAnalyzerなどはまだないので、そのあたりができてくるともっと便利になりそうです。
とりあえず、気になる方は触って見てはいかがでしょうか？
個人的は検索に関するサービスが出てきたのですごく楽しみにしています！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[データ分析基盤構築入門 を一部執筆しました。]]></title>
    <link href="http://blog.johtani.info/blog/2017/09/21/release-intro-logging-analysis-system/"/>
    <updated>2017-09-21T10:02:30+09:00</updated>
    <id>http://blog.johtani.info/blog/2017/09/21/release-intro-logging-analysis-system</id>
    <content type="html"><![CDATA[<p>久々に執筆しました。といっても、<a href="http://blog.johtani.info/blog/2014/08/04/release-magazine-book-of-log-aggs-and-viz/">以前の書籍</a>の更新版です。
まぁ、更新版といっても、私以外の方々は結構な量を書き直しor新規書き起こしされてますが。。。</p>

<p>ということで、みなさん「買って」から感想をいただけるとうれしいです！（以下の画像でAmazonにジャンプできます！Kindle版も発売中です。）</p>

<p><a target="_blank"  href="https://www.amazon.co.jp/gp/product/477419218X/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=477419218X&linkCode=as2&tag=johtani-22&linkId=f7cbe8130343ea340b18b53eba20d4b7"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&MarketPlace=JP&ASIN=477419218X&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL250_&tag=johtani-22" ></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=johtani-22&l=am2&o=9&a=477419218X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

<!-- more -->


<p>今回もElasticsearchの章を担当しました。
5.4ベースで書きましたが、ちょっとずつ6でどう変わるかなども記載してあります。
また、付録ではLogstashやBeatsにもちょっと触れています。
また、自分が一番好きなKibanaの機能であるDev ToolsのConsoleについても記載してあります。こちらも合わせて目を通していただければと。</p>

<p>みなさんのフィードバック（ツイート、ブログ、Amazonのコメントなどなど）をお待ちしております！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[検索座談会ってのをやってみた]]></title>
    <link href="http://blog.johtani.info/blog/2017/05/25/search-meetup/"/>
    <updated>2017-05-25T00:24:13+09:00</updated>
    <id>http://blog.johtani.info/blog/2017/05/25/search-meetup</id>
    <content type="html"><![CDATA[<p>久々のブログ。
Elasticsearch勉強会を主催してますが、
プロダクトを超えて、検索で共通してある課題とか、悩みとか、あるかなぁと。
その辺りを話す場所を考えてみるのいいかもと思い、検索座談会ってのを5人でやってみた。</p>

<!-- more -->


<p>とりあえず、初めてなので、5名ほどで。プロダクトはかぶってない感じでした。</p>

<h3>話した議題はこの辺り。</h3>

<ul>
<li>形態素解析の辞書は何を使ってる？有償のもの？

<ul>
<li>そもそも形態素解析？</li>
</ul>
</li>
<li>辞書の更新とかは？

<ul>
<li>シノニムってどうしてる？</li>
</ul>
</li>
<li>サジェストとかのデータはどう作ってる？どうしてる？

<ul>
<li>検索ログとかから作ってる？</li>
</ul>
</li>
<li>検索結果のランキングって検索結果だけで決めるの？

<ul>
<li>検索漏れとかキーワードのミスマッチとかどうしてる？</li>
</ul>
</li>
</ul>


<h3>今後話したい内容はこの辺かな？</h3>

<ul>
<li>緯度経度系の検索</li>
<li>画像検索、音声検索</li>
<li>検索のキーワードの調査とかしてる人とかいるかな？</li>
<li>どんな機能が欲しい？</li>
<li>前処理としてはどんなことをしてる？</li>
</ul>


<p>このあとどうしていくかはまだ考え中。知り合いを捕まえて、どんなことしてるかを聞きにいくのもいいし、議題みたいなことを決めて、それを話してくれそうな人にコンタクトして議論するのもありかなぁ。
普通の勉強会みたいなのにするかもしれないし。
とりあえず、どのくらい興味を持ってる人がいるのかがわからないので。。。</p>

<p>もちろん、Elasticsearch勉強会は別でやっていきますよ。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[今年の振り返りと来年の抱負（2016）]]></title>
    <link href="http://blog.johtani.info/blog/2016/12/31/looking-back-2016/"/>
    <updated>2016-12-31T22:22:14+09:00</updated>
    <id>http://blog.johtani.info/blog/2016/12/31/looking-back-2016</id>
    <content type="html"><![CDATA[<p>今年はRioのプレイバック見ながら書いてます。
今年はなんか長い一年だった気が。</p>

<!-- more -->


<h2>振り返り（2015年に書いた抱負から）</h2>

<p>まずは去年の抱負を元に。</p>

<h5>英語の継続</h5>

<p>継続してます。まぁ当たり前ですが。もう少し話す機会増やさないとだなぁと思いつつ。英会話しながら、海外TVドラマ見ながら。
見たドラマはこの辺かな？</p>

<ul>
<li>ER</li>
<li>SUITS</li>
<li>メンタリスト</li>
<li>Numb3rs</li>
<li>エレメンタリー</li>
<li>Agent of Shield</li>
</ul>


<p>あと、映画も見てます。とりあえず、耳を慣らすために字幕ありで見てるので、
英語だけでとは行きませんが。。。
そろそろ同じ映画を英語字幕で見るとかしたほうがいいのかもなぁ。</p>

<h5>もっとElasticsearchの開発に参加</h5>

<p>一応参加してます。ちょっとずつですが。
イベントが重なるとできなくなるので、小さなPRとかを細々とって感じですが。。。</p>

<h5>人員の倍増？</h5>

<p>倍増したかな？現時点で日本は8名になりました。そのうち1人は完全リモートです。
来年も倍増とは行かないだろうなぁ。取り急ぎ、サポートエンジニアが足りてないのでそこを埋めないと。。。</p>

<h5>日本語情報発信</h5>

<p>これはちょっと足踏みしてるかも。ブログの翻訳とかはやってるんですが、もう少しなんとかしないとなぁ。ブログも書かないと。。。</p>

<h5>Splatoon S+?</h5>

<p>なりました！とりあえずS+とSを行ったり来たりしてる感じです。
メインはノヴァネオですが、Sに落ちたら違う武器でS+に上がるまでチャレンジするってのをやってます。わかば、バケスロソーダ、プライム、ワサビくらいはやったかな？
そろそろまた違う武器かなぁ。S+99は無理そうなんで。。。</p>

<h2>振り返り(今年あったできごと)</h2>

<p>その他の今年の出来事。</p>

<ul>
<li>初香港</li>
<li>初プラハ</li>
<li>OSCなど、東京以外でのカンファレンス参加</li>
<li>厄年</li>
<li>東京オフィス！</li>
<li>BBLとかトレーニング</li>
<li>lucene-gosenをちょっとメンテ</li>
<li>Podcastデビュー？</li>
</ul>


<p>初モノ今年も多いかな。
今年は、昨年よりは長く感じた一年でした。
月1くらいで出張してたのもあるのかなぁ？
香港、プラハはもちろん会社のイベントです。
香港はジャッキーチェンの映画を彷彿とさせるところがちょくちょくあって面白かったです。
ビルとかの補修の足場が竹竿とか。
プラハも面白かったです。やっぱりヨーロッパの古い町は歴史のある建物が多くて楽しいです。</p>

<p>OSCなどのイベントも色々行きました。福岡、名古屋、大阪、京都、札幌と回りました。
それとは別に大阪、福岡も行ったかな。
来年は沖縄と広島に行きたいなぁ。。。
出張のついで？じゃないですが、御朱印集めし始めました。神社仏閣もいいですよねぇ。</p>

<p><a href="http://blog.johtani.info/blog/2016/06/30/broken-something-in-this-year/">厄年</a>はきつかった。。。たまたまだとは思うけど、お祓いに行ったのが効いたのかなぁ。後半は特に問題なかったかな。腕時計無くしたと思ったら見つかったりしたし。</p>

<p>弊社東京オフィスができました。（あんまり行ってないけど）
ときどきアクロクエストさんがセミナーを開いたりしてます。
昨年のTour Tokyo後のMeetupでもイベントスペースを使って、Drinkup（勉強会の懇親会だけバージョン）もやりました。
今後もちょこちょことイベントをやってみようかな？</p>

<p>BBLも始めました。あまりきちんと宣伝してないからそれほど依頼は来てないですが。
あとは、今年も2回日本語でトレーニングしました。
前回はほぼ満席にまでなりました。
来年も頑張りたいかな。ショートカットするためにもいいと思うんで、トレーニングを受けて欲しいんです。。。</p>

<p>lucene-gosenのメンテもしました。
といってもプログラムではなく、ビルドシステムをAntからGradleに変更したんですが。
来年もちょっとずつ触りたいな。機能面で拡充するかはわからないですが。。。</p>

<p>Podcastにもデビューさせていただきました。
wyukawaさんのPodcastです。「<a href="http://wyukawa.tumblr.com/post/153257053753/johtani%E3%81%95%E3%82%93%E3%81%A8elasticsearch%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%A9%B1%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F-guest">johtaniさんとElasticsearchについて話しました</a>」楽しかったです。
また出たいなぁというか、喋るの面白かった！</p>

<h2>来年の抱負</h2>

<ul>
<li>もちろん英語の継続</li>
<li>継続的にイベントに登壇</li>
<li>もっと開発＆ブログ</li>
<li>サポートエンジニア獲得！</li>
<li>個人的な検索勉強会の再開</li>
</ul>


<p>英語はまぁ、当たり前ですね。会社の人つかまえてもっと喋る時間増やさないとだな。</p>

<p>来年もいろんなカンファレンスなどに出てブース出したり、セッション持ったりして
もっともっと広めていかないとなぁ。
あとは、勉強会とMeetupもやっていかないと。入門編と上級編みたいに分けてみるのもありかなぁと考えて見たり。
スピーカー、ご意見募集しております。</p>

<p>開発に時間をさくための時間の活用をしていかないとなぁと。
どうも時間の使い方がまだ上手くないので。ブログも一緒ですね。。。
月1くらいのペースではかきたいな。。。
ブログもそうだけど書籍もかな？？？？
あと、外資系の他の会社の人ともまた飲みたいなー。</p>

<p>開発の時間を確保という面ではサポートエンジニアも募集中です。
最近、クライアントが増えて来てチケットが増えて来てるんで、サポートしたりもしてるんです。。。
自分の時間を増やすためにもサポートエンジニアを確保しないと。誰かいい人いないかなぁ。</p>

<p>個人的にやってた勉強会を忙しいって言って中断してるので、再開しないと。。。</p>

<p>ということで、今年もあと數十分になってしまいました。
今年も色々な方に助けていただけました。お世話になりました。
この場を借りてお礼申し上げます。</p>

<p>来年もいろんな方々に助けてもらうと思いますが、よろしくお願いいたします。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2016年のElastic Stack]]></title>
    <link href="http://blog.johtani.info/blog/2016/12/25/elasticsearch-6-features/"/>
    <updated>2016-12-25T00:03:50+09:00</updated>
    <id>http://blog.johtani.info/blog/2016/12/25/elasticsearch-6-features</id>
    <content type="html"><![CDATA[<p>Merry Christmas!
<a href="http://qiita.com/advent-calendar/2016/elastic">Elastic stack Advent Calendar 2016</a> 最終日の記事になります。</p>

<p>簡単に今年の変遷を振り返ってみます。</p>

<!-- more -->


<h2>Elasticsearch 2.2 (2月)</h2>

<ul>
<li><a href="https://www.elastic.co/jp/blog/elasticsearch-2-2-0-and-2-1-2-and-1-7-5-released">Elasticsearch 2.2.0、2.1.2、1.7.5リリース</a></li>
</ul>


<p>クエリプロファイラやGeo系の性能改善などが取り込まれました。
また、同時期にリリースされたKibana 4.4ではColor pickerやShare用のURLの短縮化機能なども追加されました。</p>

<h2>第2回目のユーザカンファレンス、Elastic{ON}開催（2月）</h2>

<p>サンフランシスコで、弊社第2回目のカンファレンスが開催されました。
2015年の会場よりも大きくなり、多数の方に参加いただきました。
ここで、以下の発表がありました。</p>

<h3>Elastic StackとX-Packの紹介</h3>

<p>これまで、ELK stackと呼ばれて意味明日が、Beatsチームの参加により、ELKだけではなくなったこともあり、Elastic Stackと呼び名を変える事になりました。
また、Marvel、Shield、Watcherなどの商用の拡張機能についても、
単体の名称ではなく、X（Extension）-Packと1つの名前になる事に。
詳細については<a href="https://www.elastic.co/jp/blog/heya-elastic-stack-and-x-pack">公式のブログ</a>をご覧ください。</p>

<h3>Elastic CloudとElastic Cloud Enterpriseの発表</h3>

<p>2015年にElasticにジョインし、
これまでFound.no（Found）と呼ばれていた弊社のElasticsearch as a Serviceが<a href="https://www.elastic.co/jp/blog/introducing-elastic-cloud-and-elastic-cloud-enterprise">Elastic Cloudと名称変更</a>しました。
また、Elastic Cloudで培っているノウハウを詰め込んだElastic Cloud Enterpriseも発表しました。実際に利用可能になるまでには
まだもう少しかかってしまいますが、アルファ版が公開されていますので、興味のある方は触ってみてください。</p>

<p>Elastic{ON}2016で撮影された、<a href="https://www.elastic.co/blog/life-without-elasticsearch-elasticon16">「Elasticsearchがないあなたの人生はどうなりますか？」</a> といった面白い動画も公開されています。</p>

<h2>Elasticsearch 2.3リリース（3月）</h2>

<ul>
<li><a href="https://www.elastic.co/jp/blog/elasticsearch-2-3-0-and-2-2-2-released">Elasticsearch 2.3.0および2.2.2をリリース</a></li>
</ul>


<p>Reindex APIが登場し、Mappingの変更やShard数の変更など、色々とデータの更新などがやりやすくなりました。
また、Task Managementの機能も追加され、長時間かかる処理を間違った場合などの対処が楽になりました。
個人的には、Deprecation Loggingの機能が導入されたことが嬉しいこととなります。次期メジャーバージョンで廃止される機能についてログに出力されるようになりました。
実際に運用されているアプリで利用している機能が今後なくなるかどうかをログを見るとわかるという仕組みです。</p>

<h2>Rally登場（4月）</h2>

<ul>
<li><a href="https://www.elastic.co/jp/blog/announcing-rally-benchmarking-for-elasticsearch">Rally登場：Elasticsearchのベンチマークツール</a></li>
</ul>


<p>Elasticsearchのベンチマークツールがリリースされました。
定期的にElasticsearchの性能を計測することは問題点を見つける事に役に立ちます。そういった手助けをしてくれるツールが公開されることは非常に便利なことかと。</p>

<h2>Elastic Stack 5 alpha1 リリース（4月）</h2>

<ul>
<li><a href="https://www.elastic.co/jp/blog/elastic-stack-release-5-0-0-alpha-1">Elastic Stack 5.0.0 alpha 1 リリース</a></li>
</ul>


<p>Ingest NodeやLucene 6、新しいKibanaのUIなど多くのものが詰まっていました。ここから多くのユーザにテストしてもらい、5.0の正式リリースを迎えることができました。</p>

<h2>Elasticsearch 2.4.0リリース（8月）</h2>

<ul>
<li><a href="https://www.elastic.co/jp/blog/release-bonanza-elasticsearch-graph-shield-watcher-marvel-reporting-logstash-2-4-beats-1-3-and-kibana-4-6-are-now-available"></a></li>
</ul>


<p>2.xの最後のマイナーバージョンリリースです。
Reportingなどの追加とドットつきフィールド名の復活がありました。</p>

<h2>Elastic Stack 5.0.0 beta1 リリース（9月）</h2>

<ul>
<li><a href="https://www.elastic.co/jp/blog/elastic-stack-release-5-0-0-beta1">Elastic Stack Release - 5.0.0-beta1</a></li>
</ul>


<p>ついにベータです。Painlessがスクリプトのデフォルトになったり、TimelionがKibanaに取り込まれるなど、正式リリースまであと少し！</p>

<h2>Prelertチームジョイン（9月）</h2>

<ul>
<li><a href="https://www.elastic.co/blog/welcome-prelert-to-the-elastic-team">Welcome Prelert to the Elastic Team</a></li>
</ul>


<p>Machine Learningエンジンを開発し、Elasticsearch,Kibanaとの組み合わせの製品をリリースしていたPrelertという会社がジョインしました。
Elasticsearchに保存された多くのデータをより活用していただくことができるかと思います。
Elastic{ON} Tour 2016 Tokyoで弊社SAの大輪の発表も人気があるものでした。まだベータ段階ですが、利用して見ることも可能です。
ビデオなどが公開されたらまたツイートしようと思います。</p>

<h2>Elastic{ON} Tour Tokyo 2016開催（12月）</h2>

<p>今年で2回目のTokyoローカルの1日イベントでした。
ブログは「まだ」書いてませんが、、、今回も盛りだくさんのイベントになりました。
早朝のトレーニング（ハンズオンではない）にも80名近くの方に参加していただけましたし、私はKibanaのキーノート＋デモという大役をもらいましたし、ちょっと大変でした。
今年もAMA（Ask Me Anything）ブースが大盛況でした。
色々な方から、弊社のサポート、開発者が色々な質問を受け、それに答えるという形です。楽しんでいただけたかと思います。
来年もぜひ開催したいなと思っています。</p>

<p>また、<a href="https://www.elastic.co/blog/first-wave-of-elasticon-17-sessions-revealed">Elastic{ON}17のセッションも</a>いくつか発表されています。
ぜひ、サンフランシスコで行われる本場のカンファレンスにもご参加ください！</p>

<h2>来年は？</h2>

<p>1月後半か2月に<a href="https://www.meetup.com/ja-JP/Tokyo-Elastic-Fantastics/">Elasticsearch勉強会</a>を検討しようと思っています。スピーカーに興味のある方は連絡いただければと。</p>

<p>会社としては、<a href="https://www.elastic.co/elasticon/conf/2017/sf">Elastic{ON}2017</a>が3月にまた開催されます。これで3回目となります。もちろん私も参加予定なので、参加される方は、現地で会いましょう！</p>

<p>そのほかにも<a href="http://www.bigdatacon.jp/ja/">BIG DATA ANALYTICS TOKYO</a>やオープンソースカンファレンス（<a href="http://www.ospn.jp/osc2017-osaka/">大阪</a>）、<a href="http://event.shoeisha.jp/devsumi/20170216/">デブサミ</a>といったカンファレンスに参加（登壇・ブースなど）予定です。
参加される方は、ぜひブースまでお越しください。</p>

<p>では、また来年のAdvent Calendarでお会いしましょう！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Elasticsearch 5.0の便利機能紹介？]]></title>
    <link href="http://blog.johtani.info/blog/2016/12/01/elasticsearch-5-dot-0-highlight/"/>
    <updated>2016-12-01T17:34:30+09:00</updated>
    <id>http://blog.johtani.info/blog/2016/12/01/elasticsearch-5-dot-0-highlight</id>
    <content type="html"><![CDATA[<p>Elastic stack Advent Calendar 1日目の記事になります。</p>

<p><a href="https://www.elastic.co/jp/blog/elasticsearch-5-0-0-released">Elasticsearch 5.0</a>が10月末にリリースされました。
リリースのブログでいくつか紹介されているのですが、そこでは紹介されていない機能について2、3紹介しようと思います。</p>

<!-- more -->


<p>その前に、5.0、あれ？その前は2.xじゃなかったっけ？？と困惑されている方もいるかと思うので、簡単に5となった経緯の紹介をしようかと。</p>

<h3>バージョン番号</h3>

<p>なぜ2から5に飛んだのかという話ですが、このスライドがその紹介になっています。</p>

<p><a href="https://speakerdeck.com/johtani/elastic-stack-5-dot-0-alpha1-alpha5?slide=5">https://speakerdeck.com/johtani/elastic-stack-5-dot-0-alpha1-alpha5?slide=5</a></p>

<p><a href="https://www.elastic.co/elasticon/conf/2016/sf/opening-keynote">Elastic{ON} 2016のキーノート</a>でも紹介がありましたが、KibanaやLogstashとElasticsearchを組み合わせて使うときにバージョンのミスマッチで動かないというユーザの声が上がっていました。
2.xのリリースから、同じ日にKibana、Logstash、Beatsもリリースするようになったのですが、
やはり、バージョン番号が異なるため、ミスマッチで動かないというユーザが時々いました。</p>

<p>Elastic Stackという名称にもなったため、バージョン番号をそろえようという事になり、
Elasticsearch、Kibana、Logstash、Beats全てが5.0.0としてリリースされ、
今後は同じバージョン番号になります。</p>

<p>ちなみに、「5」になった理由はKibanaのメジャーバージョンが「4」だったためです。</p>

<p>さて、では、いくつか機能の紹介を。</p>

<h3>Reindex from remote cluster</h3>

<p>Reindexが2.3から導入されました。データの再登録ができるようになり、マッピングの変更や
Shardの数の変更などが柔軟に行えるようになりました。
便利でしたが、あくまでも同一のクラスタでデータを登録し直す形でした。</p>

<p>5.0からはこの機能に加えて、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-reindex.html#reindex-from-remote">異なるクラスタからデータを取得してReindex</a>を行うことができるようになりました。
こんな形になります。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>POST _reindex
</span><span class='line'>{
</span><span class='line'>  "source": {
</span><span class='line'>    "remote": {
</span><span class='line'>      "host": "http://otherhost:9200",
</span><span class='line'>      "username": "user",
</span><span class='line'>      "password": "pass"
</span><span class='line'>    },
</span><span class='line'>    "index": "source",
</span><span class='line'>    "query": {
</span><span class='line'>      "match": {
</span><span class='line'>        "test": "data"
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>  },
</span><span class='line'>  "dest": {
</span><span class='line'>    "index": "dest"
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><code>username</code>と<code>password</code>はリモートのクラスタに認証の気候が存在する場合に利用できるオプションです。
また、ReindexのAPIはクエリを使用して、必要なデータだけを取得することが可能です。
この機能により、1.xや2.xのクラスタからデータを移行することが可能になります。</p>

<h3>Custom analyzer test using Analyze API</h3>

<p>もう一つ、ちょっとだけ便利な機能を紹介します。
独自にAnalyzerを定義（TokenizerとToken Filterなどを個別に設定）して、その挙動を確認するとき、2.xまでは、インデックスを作成してそのインデックスに対して<code>_analyze</code> APIを呼び出す必要がありました。</p>

<p>5.xからは<code>_analyze</code> APIの読み出しのパラメータで指定できるようになりました。
こんな感じです。ここでは、<code>lowercase</code>フィルタのあとに、<code>{...}</code>で<code>stop</code>フィルタを
パラメータの中で、指定しています。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl -XGET 'localhost:9200/_analyze' -d '
</span><span class='line'>{
</span><span class='line'>  "tokenizer" : "whitespace",
</span><span class='line'>  "filter" : ["lowercase", {"type": "stop", "stopwords": ["a", "is", "this"]}],
</span><span class='line'>  "text" : "this is a test"
</span><span class='line'>}'</span></code></pre></td></tr></table></div></figure>


<p>ちょっとだけですが、Analyzerなどを試すのが楽になるのではないでしょうか？</p>

<p>ということで、以上が1日目の記事でした。
Logstashなど、他の5.0.0に関する記事もAdvent Calendarに空きがあるようなので、個別にかこうかなと思います。お楽しみに！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Lucene Kuromoji for NEologdで指定した品詞の単語を抜き出すIngest Pluginを書いてみた #elasticsearchjp]]></title>
    <link href="http://blog.johtani.info/blog/2016/07/22/making-ingest-processor-plugin-with-cookiecutter/"/>
    <updated>2016-07-22T13:26:56+09:00</updated>
    <id>http://blog.johtani.info/blog/2016/07/22/making-ingest-processor-plugin-with-cookiecutter</id>
    <content type="html"><![CDATA[<p>久しぶりに、技術的なブログ書いてます。</p>

<p>Ingest Processorのプラグインを作ってみたくなったので、書いてみました。
ただ書いてみるんじゃ3番煎じになりそうなので、<a href="https://cookiecutter.readthedocs.io/en/latest/readme.html">cookiecutter</a>を使ってみました。</p>

<!-- more -->


<p>と言っても、同僚のAlexが<a href="https://discuss.elastic.co/t/cookiecutter-template-for-writing-ingest-processors/52985">cookiecutter-elasticsearch-ingest-processor</a>と言うテンプレートを作ってくれているのを使っただけですが。（<a href="https://discuss.elastic.co">https://discuss.elastic.co</a> に投稿された記事で、使い方がアニメgifで説明されててわかりやすいです）</p>

<p><a href="https://cookiecutter.readthedocs.io/en/latest/readme.html">cookiecutter</a>とは、コマンドラインで質問に答えると、テンプレートからプロジェクトが生成できるツールです。
Elasticでは、カスタムBeatを作る時に利用する例がいつかの日本語ブログや発表資料で話題になっていました。
これのIngest Processorのプラグインバージョンです。</p>

<p>今回は、NEologdも使ってみたかったので、Lucene Kuromoji for NEologdを利用して
指定した品詞の単語だけを抽出するProcessorを作ってみました。</p>

<p>GitHubのプロジェクト：<a href="https://github.com/johtani/elasticsearch-ingest-kuromoji-pos-extract">https://github.com/johtani/elasticsearch-ingest-kuromoji-pos-extract</a></p>

<h3>Cookiecutterの使い方</h3>

<p><a href="https://cookiecutter.readthedocs.io/en/latest/readme.html">Cookiecutterのインストールはサイト</a>をご覧ください。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cookiecutter gh:spinscale/cookiecutter-elasticsearch-ingest-processor</span></code></pre></td></tr></table></div></figure>


<p>あとは、出てくる以下の項目を指定するだけです。</p>

<ul>
<li><code>processor_type</code> : Ingest Processorのタイプ名です。<code>kuromoji_part_of_speech_extract</code>としました。（Alexのだと<code>_</code>を使うとちょっと問題があるので後述）</li>
<li><code>description</code> : readme.mdに利用されます。</li>
<li><code>developer_name</code> : 名前を記載。Javaのファイルのヘッダに利用</li>
<li><code>elasticsearch_version</code> : デフォルトで<code>5.0.0-alpha4</code>が指定されているので、特に指定せず</li>
</ul>


<p>以上の質問に答えたら、プロジェクトのディレクトリ構造が出来上がってます。
プロジェクトのビルドなどにはGradleを利用します。</p>

<h3>プロジェクトのIntelliJ IDEA用のファイルを生成</h3>

<p>build.gradleファイルでGradleのideaプラグインがapplyされているので、以下のコマンドを叩けばIntelliJ IDEAのプロジェクトファイル（？）が生成され、IntelliJで開けばすぐに開発ができる状態にできます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gradle idea</span></code></pre></td></tr></table></div></figure>


<h3>コーディング</h3>

<p>あとは、必要処理をコーディングします。
実際にコーディングするクラスは<code>org.elasticsearch.plugin.ingest.kuromoji_part_of_speech_extract</code>のパッケージにある以下の2つです。（パッケージ名にはprocessor_typeの名前が指定されている）</p>

<ul>
<li>IngestKuromojiPartOfSpeechExtractPlugin</li>
<li>KuromojiPartOfSpeechExtractProcessor</li>
</ul>


<h4>IngestKuromojiPartOfSpeechExtractPlugin</h4>

<p>Pluginというクラスは、プラグインをNodeのModuleとして登録する処理を書くクラスとなります。
生成してすぐは、次のような形になっています。（※importやクラス定義の部分は省略しています。）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="o">...</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Setting</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">YOUR_SETTING</span> <span class="o">=</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">Setting</span><span class="o">&lt;&gt;(</span><span class="s">&quot;ingest.kuromoji_part_of_speech_extract.setting&quot;</span><span class="o">,</span> <span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">value</span><span class="o">,</span> <span class="n">Setting</span><span class="o">.</span><span class="na">Property</span><span class="o">.</span><span class="na">NodeScope</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Setting</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">getSettings</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">YOUR_SETTING</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onModule</span><span class="o">(</span><span class="n">NodeModule</span> <span class="n">nodeModule</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">nodeModule</span><span class="o">.</span><span class="na">registerProcessor</span><span class="o">(</span><span class="n">KuromojiPartOfSpeechExtractProcessor</span><span class="o">.</span><span class="na">TYPE</span><span class="o">,</span>
</span><span class='line'>                <span class="o">(</span><span class="n">registry</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">KuromojiPartOfSpeechExtractProcessor</span><span class="o">.</span><span class="na">Factory</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>YOUR_SETTING</code>プロパティと<code>getSettings()</code>メソッドは<code>elasticsearch.yml</code>で指定したい設定を記述する場合の例になります。今回は特に必要ないので両方削除しました。
最終系は<a href="https://github.com/johtani/elasticsearch-ingest-kuromoji-pos-extract">GitHubのコード</a>をご覧ください。</p>

<h4>KuromojiPartOfSpeechExtractProcessor</h4>

<p>Processorは実際にIngest Nodeで行う処理を書くところです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TYPE</span> <span class="o">=</span> <span class="s">&quot;kuromoji_part_of_speech_extract&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">field</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">targetField</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">KuromojiPartOfSpeechExtractProcessor</span><span class="o">(</span><span class="n">String</span> <span class="n">tag</span><span class="o">,</span> <span class="n">String</span> <span class="n">field</span><span class="o">,</span> <span class="n">String</span> <span class="n">targetField</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">tag</span><span class="o">);</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">field</span> <span class="o">=</span> <span class="n">field</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">targetField</span> <span class="o">=</span> <span class="n">targetField</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">IngestDocument</span> <span class="n">ingestDocument</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">ingestDocument</span><span class="o">.</span><span class="na">getFieldValue</span><span class="o">(</span><span class="n">field</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">// TODO implement me!</span>
</span><span class='line'>        <span class="n">ingestDocument</span><span class="o">.</span><span class="na">setFieldValue</span><span class="o">(</span><span class="n">targetField</span><span class="o">,</span> <span class="n">content</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">TYPE</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Factory</span> <span class="kd">extends</span> <span class="n">AbstractProcessorFactory</span><span class="o">&lt;</span><span class="n">KuromojiPartOfSpeechExtractProcessor</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="n">KuromojiPartOfSpeechExtractProcessor</span> <span class="nf">doCreate</span><span class="o">(</span><span class="n">String</span> <span class="n">processorTag</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">field</span> <span class="o">=</span> <span class="n">readStringProperty</span><span class="o">(</span><span class="n">TYPE</span><span class="o">,</span> <span class="n">processorTag</span><span class="o">,</span> <span class="n">config</span><span class="o">,</span> <span class="s">&quot;field&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">targetField</span> <span class="o">=</span> <span class="n">readStringProperty</span><span class="o">(</span><span class="n">TYPE</span><span class="o">,</span> <span class="n">processorTag</span><span class="o">,</span> <span class="n">config</span><span class="o">,</span> <span class="s">&quot;target_field&quot;</span><span class="o">,</span> <span class="s">&quot;default_field_name&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="nf">KuromojiPartOfSpeechExtractProcessor</span><span class="o">(</span><span class="n">processorTag</span><span class="o">,</span> <span class="n">field</span><span class="o">,</span> <span class="n">targetField</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>TYPE</code>が<a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/put-pipeline-api.html">Ingest APIのPipelineでProcessorを指定するときに使う名前</a>になります。ここは、cookiecutterの時にprocessor_typeに入力した文字列になっています。
<code>kuromoji_part_of_speech_extract</code>だと長いので、<code>kuromoji_pos_extract</code>に変えました。</p>

<p><code>execute()</code>メソッドに<code>// TODO implement me!</code>とあります。
この部分に実際の処理を記述していきます。</p>

<p>あとは、<code>Factory</code>クラスでIngest APIで指定された設定項目を読み込みます。
今回作成した<code>elasticsearch-ingest-kuromoji-pos-extract</code>では品詞を指定する必要があるので、<code>pos_tags</code>を指定できるように処理を追加しました。</p>

<p>私が実装したものの説明をするとちょっと長くなりそうなので、<a href="https://github.com/johtani/elasticsearch-ingest-kuromoji-pos-extract">GitHubのコード</a>をご覧ください。</p>

<h3>テストのコーディング</h3>

<p>テストのクラスもテンプレートで生成されています。</p>

<ul>
<li>KuromojiPartOfSpeechExtractProcessorTests</li>
<li>KuromojiPartOfSpeechExtractRestIT</li>
</ul>


<h4>KuromojiPartOfSpeechExtractProcessorTests</h4>

<p>Processorクラスのテストになります。生成直後は次のような感じです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testThatProcessorWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>    <span class="n">document</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;source_field&quot;</span><span class="o">,</span> <span class="s">&quot;fancy source field content&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">IngestDocument</span> <span class="n">ingestDocument</span> <span class="o">=</span> <span class="n">RandomDocumentPicks</span><span class="o">.</span><span class="na">randomIngestDocument</span><span class="o">(</span><span class="n">random</span><span class="o">(),</span> <span class="n">document</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">KuromojiPartOfSpeechExtractProcessor</span> <span class="n">processor</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">KuromojiPartOfSpeechExtractProcessor</span><span class="o">(</span><span class="n">randomAsciiOfLength</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="s">&quot;source_field&quot;</span><span class="o">,</span> <span class="s">&quot;target_field&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">processor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">ingestDocument</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">ingestDocument</span><span class="o">.</span><span class="na">getSourceAndMetadata</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">hasKey</span><span class="o">(</span><span class="s">&quot;target_field&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;target_field&quot;</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;fancy source field content&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="c1">// TODO add fancy assertions here</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>テストメソッドも実装されていますが、パラメータの追加の設定処理やアサーションが書かれてません。
実装に合わせて、アサーションや設定処理を追加しましょう。</p>

<h4>KuromojiPartOfSpeechExtractRestIT</h4>

<p>こちらはIntegration Testになります。
実際にElasticsearchに対して外部からAPIを叩くような感じです。
APIを叩くときに利用するJSONの設定やアサーションは<code>src/test/resources</code>にyamlファイルがあります。</p>

<ul>
<li>10_basic.yaml</li>
<li>20_kuromoji_part_of_speech_extract_processor.yaml</li>
</ul>


<p><code>10_basic.yaml</code>はプラグインがインストールされているかの確認のテストです。特に変更する必要はないです。</p>

<p><code>20_kuromoji_part_of_speech_extract_processor.yaml</code>は実際にコーディングしたProcessorが動くかどうかのテストです。</p>

<p>テストの内容については、<a href="https://github.com/johtani/elasticsearch-ingest-kuromoji-pos-extract">GitHubのコード</a>をご覧ください。</p>

<h3>テストの実行とZipの生成</h3>

<p>テストの実行とZipの生成は次のコマンドを実行すればOKです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="n">gradle</span> <span class="n">check</span>
</span></code></pre></td></tr></table></div></figure>


<p>テストに問題があった場合は、コケますし、問題なければ<code>SUCCESS</code>と表示が出ます。
成功した場合は<code>build/distributions/</code>というディレクトリにzipファイルができています。
これをElasticsearchのpluginコマンドでインストールすれば動きます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">plugin</span> <span class="n">install</span> <span class="nl">file:</span><span class="c1">///path/to/elasticsearch-ingest-kuromoji-pos-extract/build/distribution/ingest-kuromoji_part_of_speech_extract-0.0.1-SNAPSHOT.zip</span>
</span></code></pre></td></tr></table></div></figure>


<h3>kuromoji_pos_extractの利用方法</h3>

<p>Ingest APIには便利な<a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/simulate-pipeline-api.html">Simulate Pipeline API</a>があります。</p>

<p>ということで、<a href="https://github.com/neologd/mecab-ipadic-neologd/blob/master/README.ja.md">mecab-ipadic-NEologd</a>にあったサンプルの文章を使って、使い方の説明です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='JSON'><span class='line'><span class="err">POST</span> <span class="err">_ingest/pipeline/_simulate</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;pipeline&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;kuromoji neologd extract test&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;processors&quot;</span> <span class="p">:</span> <span class="p">[</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;kuromoji_pos_extract&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;field&quot;</span> <span class="p">:</span> <span class="s2">&quot;body&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;target_field&quot;</span> <span class="p">:</span> <span class="s2">&quot;noun_field&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;pos_tags&quot;</span> <span class="p">:</span> <span class="p">[</span>
</span><span class='line'>          <span class="s2">&quot;名詞-固有名詞-組織&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;名詞-固有名詞-一般&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;名詞-固有名詞-人名-一般&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;名詞-固有名詞-地域-一般&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;名詞-固有名詞-地域-国&quot;</span>
</span><span class='line'>          <span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="p">]</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;docs&quot;</span> <span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;body&quot;</span> <span class="p">:</span> <span class="s2">&quot;10日放送の「中居正広のミになる図書館」（テレビ朝日系）で、SMAPの中居正広が、篠原信一の過去の勘違いを明かす一幕があった。&quot;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>結果はこちら。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='JSON'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;docs&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;doc&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="nt">&quot;noun_field&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="s2">&quot;10日&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;中居正広のミになる図書館&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;テレビ朝日&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;SMAP&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;中居正広&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;篠原信一&quot;</span>
</span><span class='line'>          <span class="p">],</span>
</span><span class='line'>          <span class="nt">&quot;body&quot;</span><span class="p">:</span> <span class="s2">&quot;10日放送の「中居正広のミになる図書館」（テレビ朝日系）で、SMAPの中居正広が、篠原信一の過去の勘違いを明かす一幕があった。&quot;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nt">&quot;_ingest&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2016-07-22T06:18:49.007+0000&quot;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>noun_field</code>に固有名詞の単語が抜き出せているのがわかるかと思います。</p>

<h3>Alexのテンプレートで困った点</h3>

<p>テンプレートは便利だったのですが、<code>processor_type</code>に<code>_</code>を使用したタイプ名を指定すると次のような問題（？）が発生しました。</p>

<ul>
<li>クラス名が<code>Kuromoji_part_of_speech_extractProcessor</code>となってしまう</li>
</ul>


<p>深刻な問題ではないのですが、JavaだとCamel Caseが普通なのでちょっと気になって。
ということで、<a href="https://github.com/spinscale/cookiecutter-elasticsearch-ingest-processor/pull/1">プルリク</a>作って出してみました。まだ取り込まれてないかな。</p>

<p>取り込み前に使いたい方は以下のコマンドを実行してください。
<code>processor_class_name</code>という項目が増えています。
デフォルトだと<code>processor_type</code>の<code>_</code>の部分を取り除きつつCamel Caseにしたものが入ります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='JSON'><span class='line'><span class="err">cookiecutter</span> <span class="err">gh:johtani/cookiecutter-elasticsearch-ingest-processor</span>
</span></code></pre></td></tr></table></div></figure>


<h3>まとめ</h3>

<p>ということで、とりあえず作ってみましたというものになります。
特徴的な単語（固有名詞だけ）を抜き出して、別のフィールドにできるので、タグみたいなものをこれを使って前処理で作れるようになるかなぁと。</p>

<h2>参考ブログ（元ネタ？）</h2>

<p>インスパイア元となったブログです。</p>

<ul>
<li><a href="http://dev.classmethod.jp/server-side/elasticsearch/ingest-plugin-useragent/">User Agentを解析するIngest Pluginを書いてみた</a></li>
<li><a href="http://blog.cybozu.io/entry/2016/07/05/080000">Elasticsearch 5.0.0のIngest Node用プラグインを書いた話</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[よく物が壊れる年]]></title>
    <link href="http://blog.johtani.info/blog/2016/06/30/broken-something-in-this-year/"/>
    <updated>2016-06-30T10:57:38+09:00</updated>
    <id>http://blog.johtani.info/blog/2016/06/30/broken-something-in-this-year</id>
    <content type="html"><![CDATA[<p>なんか、今年はよく物が壊れる、厄年だからかなぁ？</p>

<p>ということで、記念に何が壊れたかをブログに残しておこうかと。</p>

<!-- more -->


<ol>
<li>腕時計（壊れてないかな）

<ul>
<li>電波腕時計を使ってたんだけど、電池がへたってたのでオーバーホールしてもらった。</li>
</ul>
</li>
<li>Moto 360（壊れたというか。。。）

<ul>
<li>何度かバージョンアップしてるんだけど、数ヶ月前から、ちょっと触っただけで電源が落ちる現象が。ファームウェアのせいかAndroid Wearのバージョンアップのせいかわからないけど。。。挙げ句の果てに、電源を入れるために充電器にセットしないといけないと言う酷い仕様。。。</li>
</ul>
</li>
<li>自転車前輪

<ul>
<li>自転車で車道を横切る側溝の蓋の間に前輪がはまってすっ転んでしまい、タイヤのスポークがちょっと曲がってしまう</li>
</ul>
</li>
<li>ジーンズその1

<ul>
<li>自転車で転んだ時に、膝とかこすって破れる</li>
</ul>
</li>
<li>ジーンズその2

<ul>
<li>福岡出張中に雨で滑って派手に転んで、膝に大きな穴が。。。</li>
</ul>
</li>
<li>リュック

<ul>
<li><blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">あー、怪しいなと思ってたんだけど、やっぱりこわれた、、、 <a href="https://t.co/CD2Y7t6AOD">pic.twitter.com/CD2Y7t6AOD</a></p>&mdash; Jun Ohtani (@johtani) <a href="https://twitter.com/johtani/status/743409932981014528">2016年6月16日</a></blockquote> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
怪しいとは思ってたんだけど。。。
ということで、リュックを新調しつつ修理に出してるところ。</li>
</ul>
</li>
<li>Xperia Z3

<ul>
<li>先週金曜日にカメラのレンズが結露してるなぁと思ったら、電源が入らなくなった。補償サービスに入ってたんで、新しいZ3を次の日に送付してもらい復旧。いろいろなアプリがログインしないといけないのでかなり大変だった。。。</li>
</ul>
</li>
</ol>


<p>まだ、半年残ってるので他にも壊れるのかなぁ。。。
お祓いしてもらったので、何もなければいいんだけど。</p>

<p>ということで、なんとなく<a href="http://www.amazon.co.jp/registry/wishlist/29EMX20UN9P16/ref=cm_sw_r_tw_ws_NhjDxb61H9RBS">欲しいものリスト</a>を貼っておきますね。</p>
]]></content>
  </entry>
  
</feed>
