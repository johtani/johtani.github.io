<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>timelion on @johtaniの日記 3rd</title>
    <link>https://blog.johtani.info/tags/timelion/</link>
    <description>Recent content in timelion on @johtaniの日記 3rd</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Tue, 01 Dec 2015 11:28:11 +0900</lastBuildDate><atom:link href="https://blog.johtani.info/tags/timelion/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Timelionの紹介 - Elasticsearch Advent Calendar 2015 1日目</title>
      <link>https://blog.johtani.info/blog/2015/12/01/introduction-timelion/</link>
      <pubDate>Tue, 01 Dec 2015 11:28:11 +0900</pubDate>
      
      <guid>https://blog.johtani.info/blog/2015/12/01/introduction-timelion/</guid>
      <description>こんにちは、@johtaniです。 早いもので、師走です。今年もあと少しとなりました（今月が一番忙しかったりしますが。。。）。 ということで、A</description>
      <content:encoded><p>こんにちは、<a href="https://twitter.com/johtani">@johtani</a>です。</p>
<p>早いもので、師走です。今年もあと少しとなりました（今月が一番忙しかったりしますが。。。）。
ということで、Advent Calendarの季節が始まりました。</p>
<p>この記事は<a href="http://qiita.com/advent-calendar/2015/elasticsearch">Elasticsearch Advent Calendar 2015</a>の1日目のエントリです。</p>
<p>今日は、最近公開された<a href="https://github.com/elastic/timelion">Timelion</a>の紹介をしたいと思います。</p>
<!-- more -->
<h2 id="timelion">Timelion?</h2>
<p>11/12に公開されたばかりのアプリになります。（<a href="https://www.elastic.co/blog/timelion-timeline">公式のブログはこちら</a>。ブログでは動画による説明もあり）</p>
<p>Kibanaにプラグインとしてインストールすることで使用することができるようになるアプリです。
Timelionと書いて「Timeline」と読むようです。
Kibanaとは異なるグラフ描画のプラグインになっています。</p>
<h3 id="kibana-42からプラットフォーム化">Kibana 4.2からプラットフォーム化</h3>
<p>Kibana 4.2から、Kibanaにプラグイン機構が導入されました。
Kibanaとしての機能以外にも、プラグインとして、アプリを追加できるようになっています。
Timelionもその一つです。</p>
<h3 id="インストール">インストール</h3>
<p>Timelionを試してみるには、ElasticsearchとKibanaが必要になります。（こちらは、すでにインストールされているとして。。。）</p>
<p>Kibanaのコマンドを利用して、プラグインをインストールします。</p>
<pre><code>bin/kibana plugin -i kibana/timelion
</code></pre><p>インストールしたら、Kibanaにアクセスして、Timelionを呼び出します。</p>
<h3 id="timelionへアクセス">Timelionへアクセス</h3>
<p>ブラウザで<code>localhost:5601</code>にアクセスすると、Kibanaが出てきます。
Kibanaのプラグイン選択のアイコンをクリックし、Timelionのアイコンをクリックします。</p>

<link rel="stylesheet" href="/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20151201/switch_to_timelion.jpg" />
    </div>
    <a href="/images/entries/20151201/switch_to_timelion.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>すると、初期画面はこんな感じです。
直近15分のElasticsearchに入っているデータがが全部出てきます。
チュートリアルも出てきてます（初回起動時に出たはず）</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20151201/tutrial_timelion.jpg" />
    </div>
    <a href="/images/entries/20151201/tutrial_timelion.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>Kibanaでの検索窓の部分に関数を指定していくことで、グラフが描画できるツールになっています。</p>
<h3 id="サンプル気温データを可視化">サンプル：気温データを可視化</h3>
<p>百聞は一見に如かずということで、
<a href="http://www.data.jma.go.jp/gmd/risk/obsdl/index.php">気象庁のデータ</a>を使って、
ちょっとしたグラフを書いてみました。
1年間の気温の推移と日照時間になります。</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20151201/tenperature_naha_and_sapporo.jpg" />
    </div>
    <a href="/images/entries/20151201/tenperature_naha_and_sapporo.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>上のグラフが那覇、下グラフが札幌の気温のグラフになります。</p>
<ul>
<li>赤いライン：最高気温</li>
<li>青いライン：最低気温</li>
<li>黄色い棒グラフ：日照時間</li>
</ul>
<p>最低気温と日照時間はグラフは次のような式で描画しています。</p>
<h5 id="青いラインの最低気温">青いラインの最低気温</h5>
<p>気温のグラフになります。</p>
<pre><code>.es(index='tenki2', q='city:naha', metric='avg:temperature_min').label('min'),
</code></pre><p><code>.es()</code>がelasticsearchに対するデータ取得の関数です。
引数は次のような意味になります。</p>
<ul>
<li>index：対象とするインデックス名</li>
<li>q：検索クエリ。ここでは、cityというフィールドにnahaで検索。</li>
<li>metric：描画対象となっているデータの入ったフィールド。temperature_minというフィールドの1日毎の平均値を取得</li>
</ul>
<p>最低気温と最高気温は別々のフィールドに格納してあります。最高気温の場合は（temperature_max）を指定します。</p>
<p><code>.label(min)</code>で、グラフの凡例の指定です。
残念ながら、日本語の指定は現時点（2015年12月01日時点）ではうまくいかなかったです。（https://github.com/elastic/timelion/issues/17）</p>
<p>デフォルトでは、線グラフが選択されているので、グラフの種類は特に指定はしていません。
明確に指定する場合は<code>lines()</code>を指定します。</p>
<h5 id="黄色い棒グラフの日照時間">黄色い棒グラフの日照時間</h5>
<pre><code>.es(index='tenki2', q='city:naha', metric='avg:sunlight').label(sunlight).bars()
</code></pre><p><code>.es()</code>に関しては最低気温のグラフとほぼ一緒です。異なるのは、metricの取得対象のフィールド名です。</p>
<p><code>.label()</code>で凡例を指定しています。先程と同様です。</p>
<p>最後に、棒グラフにしたいため、<code>.bars()</code>を指定しています。</p>
<p>その他に用意されている関数について知りたい場合は、Timelionのヘルプを表示すると説明が出てきます。
<code>cusum()</code>のような値を累積して表示するような関数も用意されています。</p>


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20151201/about_help.jpg" />
    </div>
    <a href="/images/entries/20151201/about_help.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<h3 id="まとめ">まとめ</h3>
<p>Kibanaとは少し違うアプローチで時系列データを描画するためのツールとなっています。
線グラフと棒グラフを一つのグラフに描画したりもできますし、
累積のグラフなんかも描画できるようになっています。</p>
<p>実験的なプロジェクトである、Timelionの紹介でした。
ここでのノウハウがkibanaにフィードバックされると色々と面白いことになるんじゃないかなと。</p>
<h3 id="ということで">ということで、</h3>
<p>明日は、<a href="http://qiita.com/zoetro">zoetro</a>さんの「Kibanaのプラグインの話」になります。
お楽しみに！</p>
</content:encoded>
    </item>
    
  </channel>
</rss>
