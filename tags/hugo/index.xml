<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>hugo on @johtaniの日記 3rd</title>
    <link>https://blog.johtani.info/tags/hugo/</link>
    <description>Recent content in hugo on @johtaniの日記 3rd</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Fri, 21 Feb 2020 12:04:00 +0900</lastBuildDate><atom:link href="https://blog.johtani.info/tags/hugo/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>ブログ移行日記(その5) - Jugemのブログを移行</title>
      <link>https://blog.johtani.info/blog/2020/02/21/import-jugem-posts/</link>
      <pubDate>Fri, 21 Feb 2020 12:04:00 +0900</pubDate>
      
      <guid>https://blog.johtani.info/blog/2020/02/21/import-jugem-posts/</guid>
      <description>ブログ移行日記(その5)です。前回まではこちら ブログ移行日記(その1) ブログ移行日記(その2) ブログ移行日記(その3) ブログ移行日記(その4</description>
      <content:encoded><p>ブログ移行日記(その5)です。前回まではこちら</p>
<ul>
<li><a href="/blog/2020/01/22/intro-hugo-and-theme/">ブログ移行日記(その1)</a></li>
<li><a href="/blog/2020/01/23/convert-md-from-octopress-to-hugo/">ブログ移行日記(その2)</a></li>
<li><a href="/blog/2020/01/24/setting-hugo/">ブログ移行日記(その3)</a></li>
<li><a href="/blog/2020/01/28/introduce-algolia/">ブログ移行日記(その4)</a></li>
</ul>
<p>今回はこれまでとは異なる特殊な話です。</p>
<p>最初にブログを書き始めたときに利用していたのが<a href="http://johtani.jugem.jp/">Jugem</a>のブログでした。
その後、Octopressに移行して、今年、Hugoに移行したという流れです。</p>
<p>で、よくよく考えると、Jugemのブログも移行できるんじゃないか?となりました。
じゃあ、やってみるかと。なので、今回のブログは自分の備忘録です(興味のない人が大多数じゃないかな)。
一応、<a href="https://github.com/johtani/from-octopress-to-hugo/blob/master/from_jugem_to_hugo.py">Pythonで書いたプログラムはGitHubに上がっています</a>。文字列置換と正規表現のオンパレードです。</p>
<h2 id="jugemからexport">JugemからExport</h2>
<p>まずは、移行元のデータが取り出せるかどうかを調べたところ、<a href="https://support.jugem.jp/hc/ja/articles/222313727-%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E8%A8%98%E4%BA%8B%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AF%E5%87%BA%E6%9D%A5%E3%81%BE%E3%81%99%E3%81%8B-">text形式もしくはXML形式でエクスポートが可能でした</a>。</p>
<p>変換処理が必要なはずなので、XMLでダウンロードします。
独自のXMLですが、<a href="https://github.com/johtani/from-octopress-to-hugo/blob/master/from_jugem_to_hugo.py#L239">記事ごとにXMLのタグ(<code>&lt;entry&gt;</code>)でまとめられている</a>ので、処理が楽です。</p>
<h2 id="xmlをmarkdownに">XMLをMarkdownに</h2>
<p><code>&lt;entry&gt;</code>タグの下に次のような項目が入っているので、<a href="https://github.com/johtani/from-octopress-to-hugo/blob/master/from_jugem_to_hugo.py#L204">抜き出します</a>。</p>
<h3 id="ヘッダ部">ヘッダ部</h3>
<ul>
<li>title - 記事タイトル</li>
<li>author - 著者</li>
<li>category - タグ</li>
<li>date - 投稿日付</li>
<li>description : 本文(先頭部分)</li>
<li>sequel : 本文(つづき)</li>
</ul>
<p>titleからdateまでをHugoのMarkdownの<a href="https://github.com/johtani/from-octopress-to-hugo/blob/master/from_jugem_to_hugo.py#L204">ヘッダ部分として出力します</a>。
<a href="https://github.com/johtani/from-octopress-to-hugo/blob/master/from_jugem_to_hugo.py#L38">日付は形式が違うので合わせるように変換</a>し、
titleは<code>(Jugemより移植)</code>という文字列を追加しました。</p>
<p>また、Hugoの個別のコンテンツにするためにそれぞれをMarkdownのファイルに変換しています。
ファイル名は変換後の<code>date</code>の先頭10文字(<code>yyyy-MM-dd</code>)に<code>-</code>を付け加えて、
タイトルを追加しました。<a href="https://github.com/johtani/from-octopress-to-hugo/blob/master/from_jugem_to_hugo.py#L18">ホントは英語のファイル名にしたかったんですが、ちょっと手抜き</a>。ファイル名に使用できないような文字は<code>-</code>に置換しています。</p>
<h3 id="本文">本文</h3>
<p>本文部分はもう少し複雑です。
まずは、<a href="https://github.com/johtani/from-octopress-to-hugo/blob/master/from_jugem_to_hugo.py#L228">descriptionとsequelから抜き出した文字列を結合</a>します。</p>
<p>で、内部の文字列に次のようなものがあるので、それぞれMarkdownに変換したりという処理を書いてます。</p>
<ul>
<li><a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L60">HTMLのheadingタグをMarkdown形式に</a></li>
<li><a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L66">br、hr、del、strongなどのタグもMarkdown形式に</a></li>
<li><a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L112">aタグの処理</a></li>
<li><a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L93">Amazonのアフィリエイトタグの処理</a></li>
<li><a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L161">ul、olタグの処理</a></li>
</ul>
<p>などです。
アフィリエイトタグは、数行に渡るの複数のHTMLタグで記述されているので、
<a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L146">ASINと商品タイトルだけを抜き出しています</a>。
Hugoでアフィリエイトのリンクを作るために、<a href="https://github.com/ikemo3/hugo-amazon-jp">hugo-amazon-jp</a>という公開されているshortcodeを元に、カスタマイズしたものを使っています。
これ用に、<a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L104">必要なASINとタイトルを別ファイルに出力</a>したりしています。</p>
<p>また、いくつか画像を使っている記事があったのですが、これが曲者でした。
XMLに入っているimgタグに画像へのURLがあるのですが、アクセスしても存在しないURL担っています。。。
<a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L130">ブログで公開している画像のファイル名に似たものがXMLに入っていたので、URLを組み直して、ダウンロードするという処理も書いています</a>。</p>
<p>あとは、<a href="https://github.com/johtani/from-octopress-to-hugo/blob/65e29cc7e613495e0d2c75e3f617c6f778085b61/from_jugem_to_hugo.py#L81">昔ちょっと凝った書き方(spanタグで章みたいなことやってた)をしていた部分の処理</a>を加えて完成です。</p>
<h2 id="まとめ">まとめ</h2>
<p>元のXMLを見たり、抜き出したファイルを見ながら、トライアンドエラーでプログラムを書きました。
なんとなく変換できたなかっていうところで、取り込んで公開しました。
まだ、全部の記事をチェックしてないですが、なんとなく移植できたので一旦これでいいかなと。
昔の記事を見たときにおかしい場所があったら手で治すつもりでいます。</p>
<p>なんか、もうちょっとうまくプログラムかけた気もしますが、書き捨てのプログラムだと思うのでこんなもんかな。</p>
<p>1点気になっているところは、コメントの部分です。
ブログにコメントをいただいていたのですが、その部分は移植できてないです。</p>
<p>Octopresに移植していこうは、<a href="https://disqus.com/">Disqus</a>のサービスでコメント部分を提供しています。ここに移植するのも変な話だなぁと思っているので、本文にコメントを取り込む感じかなぁ？</p>
<p>もともとのJugemのサイトもそのまままだ残してあるので、そのうち気が向いたらで。</p>
</content:encoded>
    </item>
    
    <item>
      <title>OctopressからHugoへ移行中(まだ途中)</title>
      <link>https://blog.johtani.info/blog/2020/01/16/moving-to-hugo/</link>
      <pubDate>Thu, 16 Jan 2020 18:23:37 +0900</pubDate>
      
      <guid>https://blog.johtani.info/blog/2020/01/16/moving-to-hugo/</guid>
      <description>5年くらい、Octopressを使用していましたが、更新されなくなっているのと、コンテンツの生成に時間がかかることもあり、 ほかのプラットフォ</description>
      <content:encoded><p>5年くらい、Octopressを使用していましたが、更新されなくなっているのと、コンテンツの生成に時間がかかることもあり、
ほかのプラットフォームを使用するように変更しました。</p>
<p>とりあえず、今回の移行で参考にした記事とかURLをリストアップしてみました。
詳細についてはまた明日以降で。</p>
<ul>
<li>参考記事
<ul>
<li>移行関連 : <a href="https://iriya-ufo.net/blog/2018/12/27/octopress-to-hugo/#github-pages-">https://iriya-ufo.net/blog/2018/12/27/octopress-to-hugo/#github-pages-</a></li>
<li>移行関連 : <a href="https://gam0022.net/blog/2016/09/25/migrated-from-octopress-to-hugo/">https://gam0022.net/blog/2016/09/25/migrated-from-octopress-to-hugo/</a></li>
<li>Hugo自体の日本語紹介記事 : <a href="https://knowledge.sakura.ad.jp/22908/">https://knowledge.sakura.ad.jp/22908/</a></li>
</ul>
</li>
<li>Hugo概要
<ul>
<li><a href="https://gohugo.io/">https://gohugo.io/</a></li>
</ul>
</li>
<li>テーマ
<ul>
<li>一覧 : <a href="https://themes.gohugo.io/">https://themes.gohugo.io/</a></li>
<li>利用したテーマ : <a href="https://github.com/zhaohuabing/hugo-theme-cleanwhite">https://github.com/zhaohuabing/hugo-theme-cleanwhite</a></li>
</ul>
</li>
<li>データ移行
<ul>
<li>作ったスクリプト : <a href="https://github.com/johtani/from-octopress-to-hugo">https://github.com/johtani/from-octopress-to-hugo</a></li>
</ul>
</li>
<li>favicon
<ul>
<li>作ったサイト : <a href="http://emblemmatic.org/markmaker/#/">http://emblemmatic.org/markmaker/#/</a></li>
</ul>
</li>
<li>Algoliaセッティング
<ul>
<li>参考 : <a href="https://blog.uni-3.app/2019/01/02/hugo-algolia-search/">https://blog.uni-3.app/2019/01/02/hugo-algolia-search/</a></li>
</ul>
</li>
<li>GitHub Pagesでの運用
<ul>
<li><a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#types-of-github-pages">https://gohugo.io/hosting-and-deployment/hosting-on-github/#types-of-github-pages</a></li>
</ul>
</li>
</ul>
<h2 id="残タスク">残タスク</h2>
<ul>
<li>Amazonのアフィリンクをきれいに表示するlayoutか何かを用意する?　</li>
</ul>
</content:encoded>
    </item>
    
  </channel>
</rss>
