<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>JIRA on @johtaniの日記 3rd</title>
    <link>https://blog.johtani.info/tags/jira/</link>
    <description>Recent content in JIRA on @johtaniの日記 3rd</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Thu, 20 Dec 2012 20:18:00 +0900</lastBuildDate><atom:link href="https://blog.johtani.info/tags/jira/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>JIRAのDB移行（HSQLDBからPostgreSQLへ）#augj(Jugemより移植)</title>
      <link>https://blog.johtani.info/blog/2012/12/20/jira%E3%81%AEdb%E7%A7%BB%E8%A1%8Chsqldb%E3%81%8B%E3%82%89postgresql%E3%81%B8-augj/</link>
      <pubDate>Thu, 20 Dec 2012 20:18:00 +0900</pubDate>
      
      <guid>https://blog.johtani.info/blog/2012/12/20/jira%E3%81%AEdb%E7%A7%BB%E8%A1%8Chsqldb%E3%81%8B%E3%82%89postgresql%E3%81%B8-augj/</guid>
      <description>Atlassian Advent Calendar 2012の20日目。（急遽参戦） （某イケメンにMT（改変リツイート）されたので書いてみました） 久々に、勉強会以外のエントリです。（So</description>
      <content:encoded><p>Atlassian Advent Calendar 2012の20日目。（急遽参戦）
（某イケメンにMT（改変リツイート）されたので書いてみました）
久々に、勉強会以外のエントリです。（Solrとかlucene-gosenじゃないんだが。。。）</p>
<p>私は、最近忘れっぽくなってきてしまったので、さくらVPSを借りてJIRAを立てて、タスク管理とかに使い始めました。
有料ツールなので、まずは、評価版から入れましたと。
評価版をインストールするときに、楽なのでHSQLDBを選択していました。が、
インストール時に「HSQLDBは評価版だけで使用してください。正式版ではサポートしてないです」みたいなことを言われていたので、PostgreSQLに切り替えようかと。
ちなみに、MySQLも選択肢としてはあったのですが、PostgreSQLのほうが触ってるし（つかいこなせてるわけではない）、補完機能になれてるというのもありPostgreSQLを選んでみました。</p>
<p>作業のログとして、ブログ書いとこうと思いたったのでメモ的に残しておきます。</p>
<p>作業の流れはこんなかんじでした。
（基本的にはサポートサイトの<a href="https://confluence.atlassian.com/display/JIRA052/Switching+Databases#SwitchingDatabases-differenttype">ここ</a>に載ってます。サポートいいね。）
この手順通りでいいみたい。</p>
<p>###1.  JIRAのデータのバックアップ（JIRAの管理画面からバックアップ）</p>
<hr>
<p>まずは管理画面へ。ページ右上に管理へのリンクがあるのでクリック。

<link rel="stylesheet" href="/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20121220/20121220_2548699.jpg" alt="管理画面へ"/>
    </div>
    <a href="/images/entries/20121220/20121220_2548699.jpg" itemprop="contentUrl"></a>
  </figure>
</div>
</p>
<p>開いた管理画面の右下あたりにエクスポート（バックアップ）へのリンクがあります。


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20121220/20121220_2548700.jpg" alt="管理画面右下のこのへん"/>
    </div>
    <a href="/images/entries/20121220/20121220_2548700.jpg" itemprop="contentUrl"></a>
  </figure>
</div>
</p>
<p>クリックしたあとに、エクスポートのファイル指定画面が現れるので、ファイル名を指定してバックアップボタンを押します。


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20121220/20121220_2548714.jpg" alt="ファイル指定画面"/>
    </div>
    <a href="/images/entries/20121220/20121220_2548714.jpg" itemprop="contentUrl"></a>
  </figure>
</div>
</p>
<p>バックアップが完了するとバックアップファイルの場所が表示されます。


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20121220/20121220_2548701.jpg" alt="完了画面"/>
    </div>
    <a href="/images/entries/20121220/20121220_2548701.jpg" itemprop="contentUrl"></a>
  </figure>
</div>
</p>
<p>###2. JIRAの停止</p>
<hr>
<p>バックアップが終わったのでJIRAを停止します。</p>
<p>###3.  PostgreSQLのインストール（yum）
PostgreSQLが入ってないので、yum installします。（軟弱者なので）</p>
<pre><code>
yum install postgresql-server
</code></pre><p>####initdbで四苦八苦
PostgreSQLはインストールしただけでは起動できません。なので、初期化をします。
yumでインストールしたPostgreSQLだとつぎのコマンドでinitdbできるようです。（これが罠でした）</p>
<pre><code>
service postgresql initdb
</code></pre><p>このコマンドでinitdbすると、encodingが指定できませんでした。（私がしらないだけという話も。。。）
encodingを指定できていないと、このあと4.を実行するときにエラーが出ました。（これも回避方法あるのかも。）
ということで、結局、昔とった杵柄なやり方でinitdbコマンドで&ndash;encoding=UTF8 &ndash;no-localeを指定しました。</p>
<pre><code>
initdb --encoding=UTF8 --no-locale -D/var/lib/pgsql/data
service postgresql start
</code></pre><p>これで初期化が完了するので、PostgreSQLを起動します。</p>
<p>###4.  JIRA用DBとユーザの作成</p>
<hr>
<p>まずは、ユーザの作成。そして、DB作成</p>
<pre><code>
createuser jirauser
createdb -E UNICODE jiradb
</code></pre><p>テーブルなど作成しません。あとの処理がやってくれます。</p>
<p>###5.  JIRAにJDBCドライバを入れる（必要なかった。）</p>
<hr>
<p>warじゃないJIRAをインストールした場合はすでに入ってるみたいです。
ここを見るとわかります。JIRA Installation Directoryの下のlibですかね。</p>
<pre><code>
/opt/atlassian/jira/lib
</code></pre><p>###<del>6.  マニュアルでPostgreSQLの接続設定（あれ、これいらないのか。）</del></p>
<hr>
<p>~~　コンソールオンリーなので、JIRAが提供してくれているツールが使えないため、手で設定。
　/var/atlassian/application-data/jira
　にあるdbconfig.xmlを修正~~
ちゃんと英語読めってことですね。。。必要なかったです。。。</p>
<p>###7.  JIRAのdbconfig.xmlを削除</p>
<hr>
<p>DB接続の設定を初期セットアップウィザードで再設定するため、dbconfig.xmlを消します。
（一応、インストールディレクトリとホームディレクトリとかバックアップしたほうがいいみたい）
場所はここ。
中身はdbcpとかのデータソースの設定に似てました。
今は、HSQLDBのJDBCドライバが記載されてました。</p>
<pre><code>
rm /var/atlassian/application-data/jira/dbconfig.xml
</code></pre><p>###8.  JIRAの起動</p>
<hr>
<p>7.のファイルを消したあとにJIRAを起動します。</p>
<pre><code>
service jira start
</code></pre><p>###9.  JIRAにアクセスとDB接続設定</p>
<hr>
<p>アクセスすると、インストールした時と同じDB接続の指定を行うセットアップウィザードの画面が現れます。


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20121220/20121220_2548715.jpg" alt="最初のセットアップ画面"/>
    </div>
    <a href="/images/entries/20121220/20121220_2548715.jpg" itemprop="contentUrl"></a>
  </figure>
</div>
</p>
<p>今回はJIRAサーバの外にあるPostgreSQLなので、「外部」を選んで四角で囲んだ部分を入力します。
入力したら、「接続テスト」を押して接続できることを確認したら「次へ」を押します。
マシンのスペックにもよると思いますが、ここでJIRAサーバがDBに接続してテーブルのCREATEなどDBのセットアップを実行してるのでちょっと時間がかかります。</p>
<p>###10. バックアップしたデータのインポート</p>
<hr>
<p>DBのセットアップが終わったら、アプリケーションのセットアップ画面が出てきます。


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20121220/20121220_2548716.jpg" alt="インポートファイル指定画面へ"/>
    </div>
    <a href="/images/entries/20121220/20121220_2548716.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

新規インストールではないので、「ここ」にある「既存のデータをインポート」リンクをクリックします。
すると、インポートファイルの指定画面が現れるので、1.でバックアップしたファイル名を指定してインポートします。
すると、インポート中画面が出てきます。


<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/images/entries/20121220/20121220_2548817.jpg" alt="インポート中画面"/>
    </div>
    <a href="/images/entries/20121220/20121220_2548817.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

で、インポートが完了すると無事JIRAにログインできますと。</p>
<hr>
<p>とこんなかんじです。
私の場合は、まだJIRAをインストールしてから間もないため、チケットの数が少なかったり、添付ファイルが無かったりなので、すぐにインポートが完了しました。
添付ファイルがある場合は、別途添付ファイルが保存されているディレクトリのバックアップと復旧などもあるみたいです。
最初にも書きましたが、ドキュメントのサイトに「Switching Databases」という項目があり、そのページの手順で問題なく切り替えできました。
次は、定期的にデータをバックアップするのを考えないとですかね。</p>
<p>いやぁブログ書くのが、思いの外、手こずりました。
手こずった原因はスクリーンショットだったんですけどね。。。
safariでページ全体のスクリーンショットがとれなかったので、結局Chromeで<a href="http://awesomescreenshot.com/">Awesome Screenshotプラグイン</a>使いました。
safariの拡張もあるんですが、ページ全体のスクリーンショットがうまく動かないみたいです。。。
ということで、備忘録でした。（次はちゃんとSolrとかの記事書かないとなー。その前に忘年ブログかな）</p>
</content:encoded>
    </item>
    
  </channel>
</rss>
